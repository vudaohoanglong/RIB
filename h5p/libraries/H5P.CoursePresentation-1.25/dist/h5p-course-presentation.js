(()=>{var t={46:t=>{t.exports=function(t,e){this.index=t,this.parent=e}},575:(t,e,n)=>{const s=n(46),r=H5P.EventDispatcher;function i(t,e){const n=this;r.call(n),n.children=[];var i=function(t){for(let e=t;e<n.children.length;e++)n.children[e].index=e};if(n.addChild=function(e,r){void 0===r&&(r=n.children.length);const o=new s(r,n);return r===n.children.length?n.children.push(o):(n.children.splice(r,0,o),i(r)),t.call(o,e),o},n.removeChild=function(t){n.children.splice(t,1),i(t)},n.moveChild=function(t,e){const s=n.children.splice(t,1)[0];n.children.splice(e,0,s),i(e<t?e:t)},e)for(let t=0;t<e.length;t++)n.addChild(e[t])}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i}},e={};function n(s){var r=e[s];if(void 0!==r)return r.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};n.r(t),n.d(t,{Decoder:()=>fi,Encoder:()=>pi,PacketType:()=>ui,protocol:()=>di});var e=n(575),s=n.n(e);const r=()=>new Map,i=t=>{const e=r();return t.forEach(((t,n)=>{e.set(n,t)})),e},o=(t,e,n)=>{let s=t.get(e);return void 0===s&&t.set(e,s=n()),s},a=()=>new Set,c=t=>t[t.length-1],l=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},h=Array.from,d=Array.isArray;class u{constructor(){this._observers=r()}on(t,e){o(this._observers,t,a).add(e)}once(t,e){const n=(...s)=>{this.off(t,n),e(...s)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return h((this._observers.get(t)||r()).values()).forEach((t=>t(...e)))}destroy(){this._observers=r()}}const p=Math.floor,f=(Math.ceil,Math.abs),g=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),m=(t,e)=>t>e?t:e,y=(Number.isNaN,Math.pow,Math.sign,t=>0!==t?t<0:1/t<0),b=String.fromCharCode,w=(String.fromCodePoint,/^\s*/g),v=/([A-Z])/g,S=(t,e)=>(t=>t.replace(w,""))(t.replace(v,(t=>`${e}${(t=>t.toLowerCase())(t)}`))),k="undefined"!=typeof TextEncoder?new TextEncoder:null,x=k?t=>k.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,s=new Uint8Array(n);for(let t=0;t<n;t++)s[t]=e.codePointAt(t);return s};let E="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});E&&1===E.decode(new Uint8Array).length&&(E=null);const C=t=>void 0===t?null:t;let _=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},T=!0;try{"undefined"!=typeof localStorage&&(_=localStorage,T=!1)}catch(t){}const A=_,I=Object.assign,P=Object.keys,D=t=>P(t).length,O=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),L=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&L(t,e,n+1)}},M=t=>t,B=(t,e)=>{if(null==t||null==e)return((t,e)=>t===e)(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!B(t.get(n),e.get(n)))return!1;break;case Object:if(D(t)!==D(e))return!1;for(const n in t)if(!O(t,n)||!B(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!B(t[n],e[n]))return!1;break;default:return!1}return!0},$="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name),N="undefined"!=typeof window&&"undefined"!=typeof document&&!$;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let R;const j=[],H=()=>{if(void 0===R)if($){R=r();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const s=t[n];"-"===s[0]?(null!==e&&R.set(e,""),e=s):null!==e?(R.set(e,s),e=null):j.push(s)}null!==e&&R.set(e,"")}else"object"==typeof location?(R=r(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");R.set(`--${S(e,"-")}`,n),R.set(`-${S(e,"-")}`,n)}}))):R=r();return R},U=t=>H().has(t),F=t=>C($?process.env[t.toUpperCase()]:A.getItem(t));U("--"+(K="production"))||F(K);var K;const W=$&&((t,e)=>e.includes(t))(process.env.FORCE_COLOR,["true","1","2"]),q=(!U("no-colors")&&(!$||process.stdout.isTTY||W)&&(!$||U("color")||W||null!==F("COLORTERM")||(F("TERM")||"").includes("color")),t=>new Uint8Array(t)),z=(t,e,n)=>new Uint8Array(t,e,n),V=N?t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=b(t[n]);return btoa(e)}:t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),J=N?t=>{const e=atob(t),n=q(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}:t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},Q=64,G=128,Y=127,X=2147483647,Z=Number.MAX_SAFE_INTEGER,tt=(Number.MIN_SAFE_INTEGER,Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&p(t)===t));Number.isNaN,Number.parseInt;class et{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const nt=()=>new et,st=t=>{const e=new Uint8Array((t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e})(t));let n=0;for(let s=0;s<t.bufs.length;s++){const r=t.bufs[s];e.set(r,n),n+=r.length}return e.set(z(t.cbuf.buffer,0,t.cpos),n),e},rt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},it=rt,ot=(t,e)=>{for(;e>Y;)rt(t,G|Y&e),e=p(e/128);rt(t,Y&e)},at=(t,e)=>{const n=y(e);for(n&&(e=-e),rt(t,(e>63?G:0)|(n?Q:0)|63&e),e=p(e/64);e>0;)rt(t,(e>Y?G:0)|Y&e),e=p(e/128)},ct=new Uint8Array(3e4),lt=ct.length/3,ht=k&&k.encodeInto?(t,e)=>{if(e.length<lt){const n=k.encodeInto(e,ct).written||0;ot(t,n);for(let e=0;e<n;e++)rt(t,ct[e])}else ut(t,x(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),s=n.length;ot(t,s);for(let e=0;e<s;e++)rt(t,n.codePointAt(e))},dt=(t,e)=>{const n=t.cbuf.length,s=t.cpos,r=g(n-s,e.length),i=e.length-r;t.cbuf.set(e.subarray(0,r),s),t.cpos+=r,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(m(2*n,i)),t.cbuf.set(e.subarray(r)),t.cpos=i)},ut=(t,e)=>{ot(t,e.byteLength),dt(t,e)},pt=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(z(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*m(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},ft=new DataView(new ArrayBuffer(4)),gt=(t,e)=>{switch(typeof e){case"string":rt(t,119),ht(t,e);break;case"number":tt(e)&&f(e)<=X?(rt(t,125),at(t,e)):(n=e,ft.setFloat32(0,n),ft.getFloat32(0)===n?(rt(t,124),((t,e)=>{pt(t,4).setFloat32(0,e,!1)})(t,e)):(rt(t,123),((t,e)=>{pt(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":rt(t,122),((t,e)=>{pt(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)rt(t,126);else if(d(e)){rt(t,117),ot(t,e.length);for(let n=0;n<e.length;n++)gt(t,e[n])}else if(e instanceof Uint8Array)rt(t,116),ut(t,e);else{rt(t,118);const n=Object.keys(e);ot(t,n.length);for(let s=0;s<n.length;s++){const r=n[s];ht(t,r),gt(t,e[r])}}break;case"boolean":rt(t,e?120:121);break;default:rt(t,127)}var n};class mt extends et{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ot(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const yt=t=>{t.count>0&&(at(t.encoder,1===t.count?t.s:-t.s),t.count>1&&ot(t.encoder,t.count-2))};class bt{constructor(){this.encoder=new et,this.s=0,this.count=0}write(t){this.s===t?this.count++:(yt(this),this.count=1,this.s=t)}toUint8Array(){return yt(this),st(this.encoder)}}const wt=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);at(t.encoder,e),t.count>1&&ot(t.encoder,t.count-2)}};class vt{constructor(){this.encoder=new et,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(wt(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return wt(this),st(this.encoder)}}class St{constructor(){this.sarr=[],this.s="",this.lensE=new bt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new et;return this.sarr.push(this.s),this.s="",ht(t,this.sarr.join("")),dt(t,this.lensE.toUint8Array()),st(t)}}const kt=t=>new Error(t),xt=()=>{throw kt("Method unimplemented")},Et=()=>{throw kt("Unexpected case")},Ct=kt("Unexpected end of array"),_t=kt("Integer out of Range");class Tt{constructor(t){this.arr=t,this.pos=0}}const At=t=>new Tt(t),It=t=>t.pos!==t.arr.length,Pt=(t,e)=>{const n=z(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Dt=t=>Pt(t,Lt(t)),Ot=t=>t.arr[t.pos++],Lt=t=>{let e=0,n=1;const s=t.arr.length;for(;t.pos<s;){const s=t.arr[t.pos++];if(e+=(s&Y)*n,n*=128,s<G)return e;if(e>Z)throw _t}throw Ct},Mt=t=>{let e=t.arr[t.pos++],n=63&e,s=64;const r=(e&Q)>0?-1:1;if(0==(e&G))return r*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n+=(e&Y)*s,s*=128,e<G)return r*n;if(n>Z)throw _t}throw Ct},Bt=E?t=>E.decode(Dt(t)):t=>{let e=Lt(t);if(0===e)return"";{let n=String.fromCodePoint(Ot(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Ot(t));else for(;e>0;){const s=e<1e4?e:1e4,r=t.arr.subarray(t.pos,t.pos+s);t.pos+=s,n+=String.fromCodePoint.apply(null,r),e-=s}return decodeURIComponent(escape(n))}},$t=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},Nt=[t=>{},t=>null,Mt,t=>$t(t,4).getFloat32(0,!1),t=>$t(t,8).getFloat64(0,!1),t=>$t(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Bt,t=>{const e=Lt(t),n={};for(let s=0;s<e;s++){n[Bt(t)]=Rt(t)}return n},t=>{const e=Lt(t),n=[];for(let s=0;s<e;s++)n.push(Rt(t));return n},Dt],Rt=t=>Nt[127-Ot(t)](t);class jt extends Tt{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),It(this)?this.count=Lt(this)+1:this.count=-1),this.count--,this.s}}class Ht extends Tt{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=Mt(this);const t=y(this.s);this.count=1,t&&(this.s=-this.s,this.count=Lt(this)+2)}return this.count--,this.s}}class Ut extends Tt{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=Mt(this),e=1&t;this.diff=p(t/2),this.count=1,e&&(this.count=Lt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ft{constructor(t){this.decoder=new Ht(t),this.str=Bt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}crypto.subtle;const Kt=crypto.getRandomValues.bind(crypto),Wt=(Math.random,()=>Kt(new Uint32Array(1))[0]),qt=[1e7]+-1e3+-4e3+-8e3+-1e11,zt=()=>qt.replace(/[018]/g,(t=>(t^Wt()&15>>t/4).toString(16))),Vt=t=>new Promise(t);Promise.all.bind(Promise);class Jt{constructor(t,e){this.left=t,this.right=e}}const Qt=(t,e)=>new Jt(t,e),Gt="undefined"!=typeof document?document:{},Yt=("undefined"!=typeof DOMParser&&new DOMParser,Gt.ELEMENT_NODE,Gt.TEXT_NODE,Gt.CDATA_SECTION_NODE,Gt.COMMENT_NODE,Gt.DOCUMENT_NODE,Gt.DOCUMENT_TYPE_NODE,Gt.DOCUMENT_FRAGMENT_NODE,Symbol),Xt=Date.now,Zt=Yt(),te=Yt(),ee=Yt(),ne=Yt(),se=Yt(),re=Yt(),ie=Yt(),oe=Yt(),ae=Yt();Xt();Qt("font-weight","bold"),Qt("font-weight","normal"),Qt("color","blue"),Qt("color","green"),Qt("color","grey"),Qt("color","red"),Qt("color","purple"),Qt("color","orange"),Qt("color","black");const ce=(...t)=>{le.forEach((e=>e.print(t)))},le=a();const he=t=>({[Symbol.iterator](){return this},next:t}),de=(t,e)=>he((()=>{const{done:n,value:s}=t.next();return{done:n,value:n?void 0:e(s)}}));class ue{constructor(t,e){this.clock=t,this.len=e}}class pe{constructor(){this.clients=new Map}}const fe=(t,e,n)=>e.clients.forEach(((e,s)=>{const r=t.doc.store.clients.get(s);for(let s=0;s<e.length;s++){const i=e[s];fn(t,r,i.clock,i.len,n)}})),ge=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,s=t.length-1;for(;n<=s;){const r=p((n+s)/2),i=t[r],o=i.clock;if(o<=e){if(e<o+i.len)return r;n=r+1}else s=r-1}return null})(n,e.clock)},me=t=>{t.clients.forEach((t=>{let e,n;for(t.sort(((t,e)=>t.clock-e.clock)),e=1,n=1;e<t.length;e++){const s=t[n-1],r=t[e];s.clock+s.len>=r.clock?s.len=m(s.len,r.clock+r.len-s.clock):(n<e&&(t[n]=r),n++)}t.length=n}))},ye=t=>{const e=new pe;for(let n=0;n<t.length;n++)t[n].clients.forEach(((s,r)=>{if(!e.clients.has(r)){const i=s.slice();for(let e=n+1;e<t.length;e++)l(i,t[e].clients.get(r)||[]);e.clients.set(r,i)}}));return me(e),e},be=(t,e,n,s)=>{o(t.clients,e,(()=>[])).push(new ue(n,s))},we=()=>new pe,ve=t=>{const e=we();return t.clients.forEach(((t,n)=>{const s=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const r=n.id.clock;let i=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])i+=n.length;s.push(new ue(r,i))}}s.length>0&&e.clients.set(n,s)})),e},Se=(t,e)=>{ot(t.restEncoder,e.clients.size),h(e.clients.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{t.resetDsCurVal(),ot(t.restEncoder,e);const s=n.length;ot(t.restEncoder,s);for(let e=0;e<s;e++){const s=n[e];t.writeDsClock(s.clock),t.writeDsLen(s.len)}}))},ke=t=>{const e=new pe,n=Lt(t.restDecoder);for(let s=0;s<n;s++){t.resetDsCurVal();const n=Lt(t.restDecoder),s=Lt(t.restDecoder);if(s>0){const r=o(e.clients,n,(()=>[]));for(let e=0;e<s;e++)r.push(new ue(t.readDsClock(),t.readDsLen()))}}return e},xe=(t,e,n)=>{const s=new pe,r=Lt(t.restDecoder);for(let i=0;i<r;i++){t.resetDsCurVal();const r=Lt(t.restDecoder),i=Lt(t.restDecoder),o=n.clients.get(r)||[],a=an(n,r);for(let n=0;n<i;n++){const n=t.readDsClock(),i=n+t.readDsLen();if(n<a){a<i&&be(s,r,a,i-a);let t=ln(o,n),c=o[t];for(!c.deleted&&c.id.clock<n&&(o.splice(t+1,0,Qs(e,c,n-c.id.clock)),t++);t<o.length&&(c=o[t++],c.id.clock<i);)c.deleted||(i<c.id.clock+c.length&&o.splice(t,0,Qs(e,c,i-c.id.clock)),c.delete(e))}else be(s,r,n,i-n)}}if(s.clients.size>0){const t=new Le;return ot(t.restEncoder,0),Se(t,s),t.toUint8Array()}return null},Ee=Wt;class Ce extends u{constructor({guid:t=zt(),collectionid:e=null,gc:n=!0,gcFilter:s=(()=>!0),meta:r=null,autoLoad:i=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=s,this.clientID=Ee(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new rn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=i,this.meta=r,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Vt((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const a=()=>Vt((t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===t||!0===t,this.isLoaded||this.emit("load",[])})),this.whenSynced=a()}load(){const t=this._item;null===t||this.shouldLoad||kn(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(h(this.subdocs).map((t=>t.guid)))}transact(t,e=null){return kn(this,t,e)}get(t,e=Fn){const n=o(this.share,t,(()=>{const t=new e;return t._integrate(this,null),t})),s=n.constructor;if(e!==Fn&&s!==e){if(s===Fn){const s=new e;s._map=n._map,n._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=s})),s._start=n._start;for(let t=s._start;null!==t;t=t.right)t.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,os)}getText(t=""){return this.get(t,ks)}getMap(t=""){return this.get(t,cs)}getXmlFragment(t=""){return this.get(t,Es)}toJSON(){const t={};return this.share.forEach(((e,n)=>{t[n]=e.toJSON()})),t}destroy(){h(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new Ce({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,kn(t.parent.doc,(n=>{const s=e.doc;t.deleted||n.subdocsAdded.add(s),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class _e{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Lt(this.restDecoder)}readDsLen(){return Lt(this.restDecoder)}}class Te extends _e{readLeftID(){return Xe(Lt(this.restDecoder),Lt(this.restDecoder))}readRightID(){return Xe(Lt(this.restDecoder),Lt(this.restDecoder))}readClient(){return Lt(this.restDecoder)}readInfo(){return Ot(this.restDecoder)}readString(){return Bt(this.restDecoder)}readParentInfo(){return 1===Lt(this.restDecoder)}readTypeRef(){return Lt(this.restDecoder)}readLen(){return Lt(this.restDecoder)}readAny(){return Rt(this.restDecoder)}readBuf(){return(t=>{const e=q(t.byteLength);return e.set(t),e})(Dt(this.restDecoder))}readJSON(){return JSON.parse(Bt(this.restDecoder))}readKey(){return Bt(this.restDecoder)}}class Ae{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Lt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Lt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ie extends Ae{constructor(t){super(t),this.keys=[],Lt(t),this.keyClockDecoder=new Ut(Dt(t)),this.clientDecoder=new Ht(Dt(t)),this.leftClockDecoder=new Ut(Dt(t)),this.rightClockDecoder=new Ut(Dt(t)),this.infoDecoder=new jt(Dt(t),Ot),this.stringDecoder=new Ft(Dt(t)),this.parentInfoDecoder=new jt(Dt(t),Ot),this.typeRefDecoder=new Ht(Dt(t)),this.lenDecoder=new Ht(Dt(t))}readLeftID(){return new Ge(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ge(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Rt(this.restDecoder)}readBuf(){return Dt(this.restDecoder)}readJSON(){return Rt(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class Pe{constructor(){this.restEncoder=nt()}toUint8Array(){return st(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ot(this.restEncoder,t)}writeDsLen(t){ot(this.restEncoder,t)}}class De extends Pe{writeLeftID(t){ot(this.restEncoder,t.client),ot(this.restEncoder,t.clock)}writeRightID(t){ot(this.restEncoder,t.client),ot(this.restEncoder,t.clock)}writeClient(t){ot(this.restEncoder,t)}writeInfo(t){it(this.restEncoder,t)}writeString(t){ht(this.restEncoder,t)}writeParentInfo(t){ot(this.restEncoder,t?1:0)}writeTypeRef(t){ot(this.restEncoder,t)}writeLen(t){ot(this.restEncoder,t)}writeAny(t){gt(this.restEncoder,t)}writeBuf(t){ut(this.restEncoder,t)}writeJSON(t){ht(this.restEncoder,JSON.stringify(t))}writeKey(t){ht(this.restEncoder,t)}}class Oe{constructor(){this.restEncoder=nt(),this.dsCurrVal=0}toUint8Array(){return st(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,ot(this.restEncoder,e)}writeDsLen(t){0===t&&Et(),ot(this.restEncoder,t-1),this.dsCurrVal+=t}}class Le extends Oe{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new vt,this.clientEncoder=new bt,this.leftClockEncoder=new vt,this.rightClockEncoder=new vt,this.infoEncoder=new mt(it),this.stringEncoder=new St,this.parentInfoEncoder=new mt(it),this.typeRefEncoder=new bt,this.lenEncoder=new bt}toUint8Array(){const t=nt();return ot(t,0),ut(t,this.keyClockEncoder.toUint8Array()),ut(t,this.clientEncoder.toUint8Array()),ut(t,this.leftClockEncoder.toUint8Array()),ut(t,this.rightClockEncoder.toUint8Array()),ut(t,st(this.infoEncoder)),ut(t,this.stringEncoder.toUint8Array()),ut(t,st(this.parentInfoEncoder)),ut(t,this.typeRefEncoder.toUint8Array()),ut(t,this.lenEncoder.toUint8Array()),dt(t,st(this.restEncoder)),st(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){gt(this.restEncoder,t)}writeBuf(t){ut(this.restEncoder,t)}writeJSON(t){gt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Me=(t,e,n)=>{const s=new Map;n.forEach(((t,n)=>{an(e,n)>t&&s.set(n,t)})),on(e).forEach(((t,e)=>{n.has(e)||s.set(e,0)})),ot(t.restEncoder,s.size),h(s.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([n,s])=>{((t,e,n,s)=>{s=m(s,e[0].id.clock);const r=ln(e,s);ot(t.restEncoder,e.length-r),t.writeClient(n),ot(t.restEncoder,s);const i=e[r];i.write(t,s-i.id.clock);for(let n=r+1;n<e.length;n++)e[n].write(t,0)})(t,e.clients.get(n),n,s)}))},Be=(t,e,n,s=new Ie(t))=>kn(e,(t=>{t.local=!1;let e=!1;const n=t.doc,i=n.store,a=((t,e)=>{const n=r(),s=Lt(t.restDecoder);for(let r=0;r<s;r++){const s=Lt(t.restDecoder),r=new Array(s),i=t.readClient();let o=Lt(t.restDecoder);n.set(i,{i:0,refs:r});for(let n=0;n<s;n++){const s=t.readInfo();switch(31&s){case 0:{const e=t.readLen();r[n]=new Ps(Xe(i,o),e),o+=e;break}case 10:{const e=Lt(t.restDecoder);r[n]=new Zs(Xe(i,o),e),o+=e;break}default:{const a=0==(192&s),c=new Gs(Xe(i,o),null,(s&G)===G?t.readLeftID():null,null,(s&Q)===Q?t.readRightID():null,a?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,a&&32==(32&s)?t.readString():null,Ys(t,s));r[n]=c,o+=c.length}}}}return n})(s,n),c=((t,e,n)=>{const s=[];let r=h(n.keys()).sort(((t,e)=>t-e));if(0===r.length)return null;const i=()=>{if(0===r.length)return null;let t=n.get(r[r.length-1]);for(;t.refs.length===t.i;){if(r.pop(),!(r.length>0))return null;t=n.get(r[r.length-1])}return t};let a=i();if(null===a&&0===s.length)return null;const c=new rn,l=new Map,d=(t,e)=>{const n=l.get(t);(null==n||n>e)&&l.set(t,e)};let u=a.refs[a.i++];const p=new Map,f=()=>{for(const t of s){const e=t.id.client,s=n.get(e);s?(s.i--,c.clients.set(e,s.refs.slice(s.i)),n.delete(e),s.i=0,s.refs=[]):c.clients.set(e,[t]),r=r.filter((t=>t!==e))}s.length=0};for(;;){if(u.constructor!==Zs){const r=o(p,u.id.client,(()=>an(e,u.id.client)))-u.id.clock;if(r<0)s.push(u),d(u.id.client,u.id.clock-1),f();else{const i=u.getMissing(t,e);if(null!==i){s.push(u);const t=n.get(i)||{refs:[],i:0};if(t.refs.length!==t.i){u=t.refs[t.i++];continue}d(i,an(e,i)),f()}else(0===r||r<u.length)&&(u.integrate(t,r),p.set(u.id.client,u.id.clock+u.length))}}if(s.length>0)u=s.pop();else if(null!==a&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=i(),null===a)break;u=a.refs[a.i++]}}if(c.clients.size>0){const t=new Le;return Me(t,c,new Map),ot(t.restEncoder,0),{missing:l,update:t.toUint8Array()}}return null})(t,i,a),l=i.pendingStructs;if(l){for(const[t,n]of l.missing)if(n<an(i,t)){e=!0;break}if(c){for(const[t,e]of c.missing){const n=l.missing.get(t);(null==n||n>e)&&l.missing.set(t,e)}l.update=Tn([l.update,c.update])}}else i.pendingStructs=c;const d=xe(s,t,i);if(i.pendingDs){const e=new Ie(At(i.pendingDs));Lt(e.restDecoder);const n=xe(e,t,i);i.pendingDs=d&&n?Tn([d,n]):d||n}else i.pendingDs=d;if(e){const e=i.pendingStructs.update;i.pendingStructs=null,$e(t.doc,e)}}),n,!1),$e=(t,e,n,s=Ie)=>{const r=At(e);Be(r,t,n,new s(r))},Ne=(t,e,n)=>$e(t,e,n,Te),Re=(t,e=new Uint8Array([0]),n=new Le)=>{((t,e,n=new Map)=>{Me(t,e.store,n),Se(t,ve(e.store))})(n,t,Ue(e));const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(An(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===De)return Cn(s.map(((t,e)=>0===e?t:Ln(t))));if(n.constructor===Le)return Tn(s)}return s[0]},je=(t,e)=>Re(t,e,new De),He=t=>{const e=new Map,n=Lt(t.restDecoder);for(let s=0;s<n;s++){const n=Lt(t.restDecoder),s=Lt(t.restDecoder);e.set(n,s)}return e},Ue=t=>He(new _e(At(t))),Fe=(t,e)=>(ot(t.restEncoder,e.size),h(e.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{ot(t.restEncoder,e),ot(t.restEncoder,n)})),t),Ke=(t,e=new Oe)=>(t instanceof Map?Fe(e,t):((t,e)=>{Fe(t,on(e.store))})(e,t),e.toUint8Array()),We=t=>Ke(t,new Pe);class qe{constructor(){this.l=[]}}const ze=()=>new qe,Ve=(t,e)=>t.l.push(e),Je=(t,e)=>{const n=t.l;n.length;t.l=n.filter((t=>e!==t)),t.l.length},Qe=(t,e,n)=>L(t.l,[e,n]);class Ge{constructor(t,e){this.client=t,this.clock=e}}const Ye=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,Xe=(t,e)=>new Ge(t,e),Ze=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Et()};class tn{constructor(t,e){this.ds=t,this.sv=e}}const en=(t,e)=>new tn(t,e),nn=(en(we(),new Map),(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!ge(e.ds,t.id)),sn=(t,e)=>{const n=o(t.meta,sn,a),s=t.doc.store;n.has(e)||(e.sv.forEach(((e,n)=>{e<an(s,n)&&un(t,Xe(n,e))})),fe(t,e.ds,(t=>{})),n.add(e))};class rn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const on=t=>{const e=new Map;return t.clients.forEach(((t,n)=>{const s=t[t.length-1];e.set(n,s.id.clock+s.length)})),e},an=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const s=n[n.length-1];return s.id.clock+s.length},cn=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw Et()}n.push(e)},ln=(t,e)=>{let n=0,s=t.length-1,r=t[s],i=r.id.clock;if(i===e)return s;let o=p(e/(i+r.length-1)*s);for(;n<=s;){if(r=t[o],i=r.id.clock,i<=e){if(e<i+r.length)return o;n=o+1}else s=o-1;o=p((n+s)/2)}throw Et()},hn=(t,e)=>{const n=t.clients.get(e.client);return n[ln(n,e.clock)]},dn=(t,e,n)=>{const s=ln(e,n),r=e[s];return r.id.clock<n&&r instanceof Gs?(e.splice(s+1,0,Qs(t,r,n-r.id.clock)),s+1):s},un=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[dn(t,n,e.clock)]},pn=(t,e,n)=>{const s=e.clients.get(n.client),r=ln(s,n.clock),i=s[r];return n.clock!==i.id.clock+i.length-1&&i.constructor!==Ps&&s.splice(r+1,0,Qs(t,i,n.clock-i.id.clock+1)),i},fn=(t,e,n,s,r)=>{if(0===s)return;const i=n+s;let o,a=dn(t,e,n);do{o=e[a++],i<o.id.clock+o.length&&dn(t,e,i),r(o)}while(a<e.length&&e[a].id.clock<i)};class gn{constructor(t,e,n){this.doc=t,this.deleteSet=new pe,this.beforeState=on(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const mn=(t,e)=>!(0===e.deleteSet.clients.size&&!((t,e)=>{for(const[n,s]of t)if(e(s,n))return!0;return!1})(e.afterState,((t,n)=>e.beforeState.get(n)!==t)))&&(me(e.deleteSet),((t,e)=>{Me(t,e.doc.store,e.beforeState)})(t,e),Se(t,e.deleteSet),!0),yn=(t,e,n)=>{const s=e._item;(null===s||s.id.clock<(t.beforeState.get(s.id.client)||0)&&!s.deleted)&&o(t.changed,e,a).add(n)},bn=(t,e)=>{const n=t[e-1],s=t[e];n.deleted===s.deleted&&n.constructor===s.constructor&&n.mergeWith(s)&&(t.splice(e,1),s instanceof Gs&&null!==s.parentSub&&s.parent._map.get(s.parentSub)===s&&s.parent._map.set(s.parentSub,n))},wn=(t,e,n)=>{for(const[s,r]of t.clients.entries()){const t=e.clients.get(s);for(let s=r.length-1;s>=0;s--){const i=r[s],o=i.clock+i.len;for(let s=ln(t,i.clock),r=t[s];s<t.length&&r.id.clock<o;r=t[++s]){const r=t[s];if(i.clock+i.len<=r.id.clock)break;r instanceof Gs&&r.deleted&&!r.keep&&n(r)&&r.gc(e,!1)}}}},vn=(t,e)=>{t.clients.forEach(((t,n)=>{const s=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=g(s.length-1,1+ln(s,n.clock+n.len-1)),e=s[t];t>0&&e.id.clock>=n.clock;e=s[--t])bn(s,t)}}))},Sn=(t,e)=>{if(e<t.length){const n=t[e],s=n.doc,r=s.store,i=n.deleteSet,o=n._mergeStructs;try{me(i),n.afterState=on(n.doc.store),s.emit("beforeObserverCalls",[n,s]);const a=[];n.changed.forEach(((t,e)=>a.push((()=>{null!==e._item&&e._item.deleted||e._callObserver(n,t)})))),a.push((()=>{n.changedParentTypes.forEach(((t,e)=>a.push((()=>{null!==e._item&&e._item.deleted||((t=t.filter((t=>null===t.target._item||!t.target._item.deleted))).forEach((t=>{t.currentTarget=e})),t.sort(((t,e)=>t.path.length-e.path.length)),Qe(e._dEH,t,n))})))),a.push((()=>s.emit("afterTransaction",[n,s])))})),L(a,[])}finally{s.gc&&wn(i,r,s.gcFilter),vn(i,r),n.afterState.forEach(((t,e)=>{const s=n.beforeState.get(e)||0;if(s!==t){const t=r.clients.get(e),n=m(ln(t,s),1);for(let e=t.length-1;e>=n;e--)bn(t,e)}}));for(let t=0;t<o.length;t++){const{client:e,clock:n}=o[t].id,s=r.clients.get(e),i=ln(s,n);i+1<s.length&&bn(s,i+1),i>0&&bn(s,i)}if(n.local||n.afterState.get(s.clientID)===n.beforeState.get(s.clientID)||(ce(oe,Zt,"[yjs] ",te,re,"Changed the client-id because another client seems to be using it."),s.clientID=Ee()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const t=new De;mn(t,n)&&s.emit("update",[t.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const t=new Le;mn(t,n)&&s.emit("updateV2",[t.toUint8Array(),n.origin,s,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach((t=>{t.clientID=s.clientID,null==t.collectionid&&(t.collectionid=s.collectionid),s.subdocs.add(t)})),l.forEach((t=>s.subdocs.delete(t))),s.emit("subdocs",[{loaded:c,added:a,removed:l},s,n]),l.forEach((t=>t.destroy()))),t.length<=e+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,t])):Sn(t,e+1)}}},kn=(t,e,n=null,s=!0)=>{const r=t._transactionCleanups;let i=!1,o=null;null===t._transaction&&(i=!0,t._transaction=new gn(t,n,s),r.push(t._transaction),1===r.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const e=t._transaction===r[0];t._transaction=null,e&&Sn(r,0)}}return o};class xn{constructor(t,e){this.gen=function*(t){const e=Lt(t.restDecoder);for(let n=0;n<e;n++){const e=Lt(t.restDecoder),n=t.readClient();let s=Lt(t.restDecoder);for(let r=0;r<e;r++){const e=t.readInfo();if(10===e){const e=Lt(t.restDecoder);yield new Zs(Xe(n,s),e),s+=e}else if(0!=(31&e)){const r=0==(192&e),i=new Gs(Xe(n,s),null,(e&G)===G?t.readLeftID():null,null,(e&Q)===Q?t.readRightID():null,r?t.readParentInfo()?t.readString():t.readLeftID():null,r&&32==(32&e)?t.readString():null,Ys(t,e));yield i,s+=i.length}else{const e=t.readLen();yield new Ps(Xe(n,s),e),s+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Zs);return this.curr}}class En{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Cn=t=>Tn(t,Te,De),_n=(t,e)=>{if(t.constructor===Ps){const{client:n,clock:s}=t.id;return new Ps(Xe(n,s+e),t.length-e)}if(t.constructor===Zs){const{client:n,clock:s}=t.id;return new Zs(Xe(n,s+e),t.length-e)}{const n=t,{client:s,clock:r}=n.id;return new Gs(Xe(s,r+e),null,Xe(s,r+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Tn=(t,e=Ie,n=Le)=>{if(1===t.length)return t[0];const s=t.map((t=>new e(At(t))));let r=s.map((t=>new xn(t,!0))),i=null;const o=new n,a=new En(o);for(;r=r.filter((t=>null!==t.curr)),r.sort(((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===Zs?1:-1:n}return e.curr.id.client-t.curr.id.client})),0!==r.length;){const t=r[0],e=t.curr.id.client;if(null!==i){let n=t.curr,s=!1;for(;null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client;)n=t.next(),s=!0;if(null===n||n.id.client!==e||s&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(e!==i.struct.id.client)Pn(a,i.struct,i.offset),i={struct:n,offset:0},t.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===Zs)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{Pn(a,i.struct,i.offset);const t=n.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Zs(Xe(e,i.struct.id.clock+i.struct.length),t),offset:0}}else{const e=i.struct.id.clock+i.struct.length-n.id.clock;e>0&&(i.struct.constructor===Zs?i.struct.length-=e:n=_n(n,e)),i.struct.mergeWith(n)||(Pn(a,i.struct,i.offset),i={struct:n,offset:0},t.next())}}else i={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==Zs;n=t.next())Pn(a,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(Pn(a,i.struct,i.offset),i=null),Dn(a);const c=s.map((t=>ke(t))),l=ye(c);return Se(o,l),o.toUint8Array()},An=(t,e,n=Ie,s=Le)=>{const r=Ue(e),i=new s,o=new En(i),a=new n(At(t)),c=new xn(a,!1);for(;c.curr;){const t=c.curr,e=t.id.client,n=r.get(e)||0;if(c.curr.constructor!==Zs)if(t.id.clock+t.length>n)for(Pn(o,t,m(n-t.id.clock,0)),c.next();c.curr&&c.curr.id.client===e;)Pn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===e&&c.curr.id.clock+c.curr.length<=n;)c.next();else c.next()}Dn(o);const l=ke(a);return Se(i,l),i.toUint8Array()},In=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:st(t.encoder.restEncoder)}),t.encoder.restEncoder=nt(),t.written=0)},Pn=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&In(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ot(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Dn=t=>{In(t);const e=t.encoder.restEncoder;ot(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const s=t.clientStructs[n];ot(e,s.written),dt(e,s.restEncoder)}},On=(t,e,n,s)=>{const r=new n(At(t)),i=new xn(r,!1),o=new s,a=new En(o);for(let t=i.curr;null!==t;t=i.next())Pn(a,e(t),0);Dn(a);const c=ke(r);return Se(o,c),o.toUint8Array()},Ln=t=>On(t,M,Ie,De);class Mn{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return Bn(this.currentTarget,this.target)}deletes(t){return ge(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach((n=>{if(null!==n){const s=e._map.get(n);let r,i;if(this.adds(s)){let t=s.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(s)){if(null===t||!this.deletes(t))return;r="delete",i=c(t.content.getContent())}else null!==t&&this.deletes(t)?(r="update",i=c(t.content.getContent())):(r="add",i=void 0)}else{if(!this.deletes(s))return;r="delete",i=c(s.content.getContent())}t.set(n,{action:r,oldValue:i})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){const e=this.target,n=a(),s=a(),r=[];t={added:n,deleted:s,delta:r,keys:this.keys};if(this.transaction.changed.get(e).has(null)){let t=null;const i=()=>{t&&r.push(t)};for(let r=e._start;null!==r;r=r.right)r.deleted?this.deletes(r)&&!this.adds(r)&&(null!==t&&void 0!==t.delete||(i(),t={delete:0}),t.delete+=r.length,s.add(r)):this.adds(r)?(null!==t&&void 0!==t.insert||(i(),t={insert:[]}),t.insert=t.insert.concat(r.content.getContent()),n.add(r)):(null!==t&&void 0!==t.retain||(i(),t={retain:0}),t.retain+=r.length);null!==t&&void 0===t.retain&&i()}this._changes=t}return t}}const Bn=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,s=e._item.parent._start;for(;s!==e._item&&null!==s;)s.deleted||t++,s=s.right;n.unshift(t)}e=e._item.parent}return n};let $n=0;class Nn{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=$n++}}const Rn=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=$n++},jn=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,n)=>f(e-t.index)<f(e-n.index)?t:n));let s=t._start,r=0;for(null!==n&&(s=n.p,r=n.index,(t=>{t.timestamp=$n++})(n));null!==s.right&&r<e;){if(!s.deleted&&s.countable){if(e<r+s.length)break;r+=s.length}s=s.right}for(;null!==s.left&&r>e;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);for(;null!==s.left&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);return null!==n&&f(n.index-r)<s.parent.length/80?(Rn(n,s,r),n):((t,e,n)=>{if(t.length>=80){const s=t.reduce(((t,e)=>t.timestamp<e.timestamp?t:e));return Rn(s,e,n),s}{const s=new Nn(e,n);return t.push(s),s}})(t._searchMarker,s,r)},Hn=(t,e,n)=>{for(let s=t.length-1;s>=0;s--){const r=t[s];if(n>0){let e=r.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(r.index-=e.length);if(null===e||!0===e.marker){t.splice(s,1);continue}r.p=e,e.marker=!0}(e<r.index||n>0&&e===r.index)&&(r.index=m(e,r.index+n))}},Un=(t,e,n)=>{const s=t,r=e.changedParentTypes;for(;o(r,t,(()=>[])).push(n),null!==t._item;)t=t._item.parent;Qe(s._eH,n,e)};class Fn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ze(),this._dEH=ze(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw xt()}clone(){throw xt()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ve(this._eH,t)}observeDeep(t){Ve(this._dEH,t)}unobserve(t){Je(this._eH,t)}unobserveDeep(t){Je(this._dEH,t)}toJSON(){}}const Kn=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let s=n-e;const r=[];let i=t._start;for(;null!==i&&s>0;){if(i.countable&&!i.deleted){const t=i.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&s>0;n++)r.push(t[n]),s--;e=0}}i=i.right}return r},Wn=t=>{const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},qn=(t,e)=>{let n=0,s=t._start;for(;null!==s;){if(s.countable&&!s.deleted){const r=s.content.getContent();for(let s=0;s<r.length;s++)e(r[s],n++,t)}s=s.right}},zn=(t,e)=>{const n=[];return qn(t,((s,r)=>{n.push(e(s,r,t))})),n},Vn=t=>{let e=t._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),s=0,e=e.right}const t=n[s++];return n.length<=s&&(n=null),{done:!1,value:t}}}},Jn=(t,e)=>{const n=jn(t,e);let s=t._start;for(null!==n&&(s=n.p,e-=n.index);null!==s;s=s.right)if(!s.deleted&&s.countable){if(e<s.length)return s.content.getContent()[e];e-=s.length}},Qn=(t,e,n,s)=>{let r=n;const i=t.doc,o=i.clientID,a=i.store,c=null===n?e._start:n.right;let l=[];const h=()=>{l.length>0&&(r=new Gs(Xe(o,an(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Rs(l)),r.integrate(t,0),l=[])};s.forEach((n=>{if(null===n)l.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(n);break;default:switch(h(),n.constructor){case Uint8Array:case ArrayBuffer:r=new Gs(Xe(o,an(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Ds(new Uint8Array(n))),r.integrate(t,0);break;case Ce:r=new Gs(Xe(o,an(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Ms(n)),r.integrate(t,0);break;default:if(!(n instanceof Fn))throw new Error("Unexpected content type in insert operation");r=new Gs(Xe(o,an(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Js(n)),r.integrate(t,0)}}})),h()},Gn=kt("Length exceeded!"),Yn=(t,e,n,s)=>{if(n>e._length)throw Gn;if(0===n)return e._searchMarker&&Hn(e._searchMarker,n,s.length),Qn(t,e,null,s);const r=n,i=jn(e,n);let o=e._start;for(null!==i&&(o=i.p,0===(n-=i.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&un(t,Xe(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Hn(e._searchMarker,r,s.length),Qn(t,e,o,s)},Xn=(t,e,n,s)=>{if(0===s)return;const r=n,i=s,o=jn(e,n);let a=e._start;for(null!==o&&(a=o.p,n-=o.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&un(t,Xe(a.id.client,a.id.clock+n)),n-=a.length);for(;s>0&&null!==a;)a.deleted||(s<a.length&&un(t,Xe(a.id.client,a.id.clock+s)),a.delete(t),s-=a.length),a=a.right;if(s>0)throw Gn;e._searchMarker&&Hn(e._searchMarker,r,-i+s)},Zn=(t,e,n)=>{const s=e._map.get(n);void 0!==s&&s.delete(t)},ts=(t,e,n,s)=>{const r=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(null==s)a=new Rs([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Rs([s]);break;case Uint8Array:a=new Ds(s);break;case Ce:a=new Ms(s);break;default:if(!(s instanceof Fn))throw new Error("Unexpected content type");a=new Js(s)}new Gs(Xe(o,an(i.store,o)),r,r&&r.lastId,null,null,e,n,a).integrate(t,0)},es=(t,e)=>{const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},ns=t=>{const e={};return t._map.forEach(((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])})),e},ss=(t,e)=>{const n=t._map.get(e);return void 0!==n&&!n.deleted},rs=t=>((t,e)=>he((()=>{let n;do{n=t.next()}while(!n.done&&!e(n.value));return n})))(t.entries(),(t=>!t[1].deleted));class is extends Mn{constructor(t,e){super(t,e),this._transaction=e}}class os extends Fn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new os;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new os}clone(){const t=new os;return t.insert(0,this.toArray().map((t=>t instanceof Fn?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Un(this,t,new is(this,t))}insert(t,e){null!==this.doc?kn(this.doc,(n=>{Yn(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?kn(this.doc,(e=>{((t,e,n)=>{let s=(e._searchMarker||[]).reduce(((t,e)=>e.index>t.index?e:t),{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;Qn(t,e,s,n)})(e,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?kn(this.doc,(n=>{Xn(n,this,t,e)})):this._prelimContent.splice(t,e)}get(t){return Jn(this,t)}toArray(){return Wn(this)}slice(t=0,e=this.length){return Kn(this,t,e)}toJSON(){return this.map((t=>t instanceof Fn?t.toJSON():t))}map(t){return zn(this,t)}forEach(t){qn(this,t)}[Symbol.iterator](){return Vn(this)}_write(t){t.writeTypeRef(Us)}}class as extends Mn{constructor(t,e,n){super(t,e),this.keysChanged=n}}class cs extends Fn{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach(((t,e)=>{this.set(e,t)})),this._prelimContent=null}_copy(){return new cs}clone(){const t=new cs;return this.forEach(((e,n)=>{t.set(n,e instanceof Fn?e.clone():e)})),t}_callObserver(t,e){Un(this,t,new as(this,t,e))}toJSON(){const t={};return this._map.forEach(((e,n)=>{if(!e.deleted){const s=e.content.getContent()[e.length-1];t[n]=s instanceof Fn?s.toJSON():s}})),t}get size(){return[...rs(this._map)].length}keys(){return de(rs(this._map),(t=>t[0]))}values(){return de(rs(this._map),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return de(rs(this._map),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this._map.forEach(((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?kn(this.doc,(e=>{Zn(e,this,t)})):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?kn(this.doc,(n=>{ts(n,this,t,e)})):this._prelimContent.set(t,e),e}get(t){return es(this,t)}has(t){return ss(this,t)}clear(){null!==this.doc?kn(this.doc,(t=>{this.forEach((function(e,n,s){Zn(t,s,n)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(Fs)}}const ls=(t,e)=>t===e||"object"==typeof t&&"object"==typeof e&&t&&e&&((t,e)=>t===e||D(t)===D(e)&&((t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0})(t,((t,n)=>(void 0!==t||O(e,n))&&e[n]===t)))(t,e);class hs{constructor(t,e,n,s){this.left=t,this.right=e,this.index=n,this.currentAttributes=s}forward(){if(null===this.right&&Et(),this.right.content.constructor===$s)this.right.deleted||fs(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const ds=(t,e,n)=>{for(;null!==e.right&&n>0;){if(e.right.content.constructor===$s)e.right.deleted||fs(e.currentAttributes,e.right.content);else e.right.deleted||(n<e.right.length&&un(t,Xe(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);e.left=e.right,e.right=e.right.right}return e},us=(t,e,n)=>{const s=new Map,r=jn(e,n);if(r){const e=new hs(r.p.left,r.p,r.index,s);return ds(t,e,n-r.index)}{const r=new hs(null,e._start,0,s);return ds(t,r,n)}},ps=(t,e,n,s)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===$s&&ls(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const r=t.doc,i=r.clientID;s.forEach(((s,o)=>{const a=n.left,c=n.right,l=new Gs(Xe(i,an(r.store,i)),a,a&&a.lastId,c,c&&c.id,e,null,new $s(o,s));l.integrate(t,0),n.right=l,n.forward()}))},fs=(t,e)=>{const{key:n,value:s}=e;null===s?t.delete(n):t.set(n,s)},gs=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===$s&&ls(e[t.right.content.key]||null,t.right.content.value));)t.forward()},ms=(t,e,n,s)=>{const r=t.doc,i=r.clientID,o=new Map;for(const a in s){const c=s[a],l=n.currentAttributes.get(a)||null;if(!ls(l,c)){o.set(a,l);const{left:s,right:h}=n;n.right=new Gs(Xe(i,an(r.store,i)),s,s&&s.lastId,h,h&&h.id,e,null,new $s(a,c)),n.right.integrate(t,0),n.forward()}}return o},ys=(t,e,n,s,r)=>{n.currentAttributes.forEach(((t,e)=>{void 0===r[e]&&(r[e]=null)}));const i=t.doc,o=i.clientID;gs(n,r);const a=ms(t,e,n,r),c=s.constructor===String?new js(s):s instanceof Fn?new Js(s):new Bs(s);let{left:l,right:h,index:d}=n;e._searchMarker&&Hn(e._searchMarker,n.index,c.getLength()),h=new Gs(Xe(o,an(i.store,o)),l,l&&l.lastId,h,h&&h.id,e,null,c),h.integrate(t,0),n.right=h,n.index=d,n.forward(),ps(t,e,n,a)},bs=(t,e,n,s,r)=>{const i=t.doc,o=i.clientID;gs(n,r);const a=ms(t,e,n,r);t:for(;null!==n.right&&(s>0||a.size>0&&(n.right.deleted||n.right.content.constructor===$s));){if(!n.right.deleted)switch(n.right.content.constructor){case $s:{const{key:e,value:i}=n.right.content,o=r[e];if(void 0!==o){if(ls(o,i))a.delete(e);else{if(0===s)break t;a.set(e,i)}n.right.delete(t)}else n.currentAttributes.set(e,i);break}default:s<n.right.length&&un(t,Xe(n.right.id.client,n.right.id.clock+s)),s-=n.right.length}n.forward()}if(s>0){let r="";for(;s>0;s--)r+="\n";n.right=new Gs(Xe(o,an(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new js(r)),n.right.integrate(t,0),n.forward()}ps(t,e,n,a)},ws=(t,e,n,s,i)=>{let o=e;const a=r();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===$s){const t=o.content;a.set(t.key,t)}o=o.right}let c=0,l=!1;for(;e!==o;){if(n===e&&(l=!0),!e.deleted){const n=e.content;switch(n.constructor){case $s:{const{key:r,value:o}=n,h=s.get(r)||null;a.get(r)===n&&h!==o||(e.delete(t),c++,l||(i.get(r)||null)!==o||h===o||(null===h?i.delete(r):i.set(r,h))),l||e.deleted||fs(i,n);break}}}e=e.right}return c},vs=(t,e,n)=>{const s=n,r=i(e.currentAttributes),o=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case Js:case Bs:case js:n<e.right.length&&un(t,Xe(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}o&&ws(t,o,e.right,r,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&Hn(a._searchMarker,e.index,-s+n),e};class Ss extends Mn{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];kn(t,(t=>{const n=new Map,s=new Map;let r=this.target._start,i=null;const o={};let a="",c=0,l=0;const h=()=>{if(null!==i){let t=null;switch(i){case"delete":l>0&&(t={delete:l}),l=0;break;case"insert":("object"==typeof a||a.length>0)&&(t={insert:a},n.size>0&&(t.attributes={},n.forEach(((e,n)=>{null!==e&&(t.attributes[n]=e)})))),a="";break;case"retain":c>0&&(t={retain:c},(t=>{for(const e in t)return!1;return!0})(o)||(t.attributes=I({},o))),c=0}t&&e.push(t),i=null}};for(;null!==r;){switch(r.content.constructor){case Js:case Bs:this.adds(r)?this.deletes(r)||(h(),i="insert",a=r.content.getContent()[0],h()):this.deletes(r)?("delete"!==i&&(h(),i="delete"),l+=1):r.deleted||("retain"!==i&&(h(),i="retain"),c+=1);break;case js:this.adds(r)?this.deletes(r)||("insert"!==i&&(h(),i="insert"),a+=r.content.str):this.deletes(r)?("delete"!==i&&(h(),i="delete"),l+=r.length):r.deleted||("retain"!==i&&(h(),i="retain"),c+=r.length);break;case $s:{const{key:e,value:a}=r.content;if(this.adds(r)){if(!this.deletes(r)){const c=n.get(e)||null;ls(c,a)?null!==a&&r.delete(t):("retain"===i&&h(),ls(a,s.get(e)||null)?delete o[e]:o[e]=a)}}else if(this.deletes(r)){s.set(e,a);const t=n.get(e)||null;ls(t,a)||("retain"===i&&h(),o[e]=t)}else if(!r.deleted){s.set(e,a);const n=o[e];void 0!==n&&(ls(n,a)?null!==n&&r.delete(t):("retain"===i&&h(),null===a?delete o[e]:o[e]=a))}r.deleted||("insert"===i&&h(),fs(n,r.content));break}}r=r.right}for(h();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}})),this._delta=e}return this._delta}}class ks extends Fn{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach((t=>t()))}catch(t){}this._pending=null}_copy(){return new ks}clone(){const t=new ks;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Ss(this,t,e),s=t.doc;if(Un(this,t,n),!t.local){let e=!1;for(const[n,r]of t.afterState.entries()){const i=t.beforeState.get(n)||0;if(r!==i&&(fn(t,s.store.clients.get(n),i,r,(t=>{t.deleted||t.content.constructor!==$s||(e=!0)})),e))break}e||fe(t,t.deleteSet,(t=>{t instanceof Ps||e||t.parent===this&&t.content.constructor===$s&&(e=!0)})),kn(s,(t=>{e?(t=>{let e=0;kn(t.doc,(n=>{let s=t._start,o=t._start,a=r();const c=i(a);for(;o;)!1===o.deleted&&(o.content.constructor===$s?fs(c,o.content):(e+=ws(n,s,o,a,c),a=i(c),s=o)),o=o.right}))})(this):fe(t,t.deleteSet,(e=>{e instanceof Ps||e.parent===this&&((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===$s){const s=e.content.key;n.has(s)?e.delete(t):n.add(s)}e=e.left}})(t,e)}))}))}}toString(){let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===js&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?kn(this.doc,(n=>{const s=new hs(null,this._start,0,new Map);for(let r=0;r<t.length;r++){const i=t[r];if(void 0!==i.insert){const o=e||"string"!=typeof i.insert||r!==t.length-1||null!==s.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof o||o.length>0)&&ys(n,this,s,o,i.attributes||{})}else void 0!==i.retain?bs(n,this,s,i.retain,i.attributes||{}):void 0!==i.delete&&vs(n,s,i.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,e,n){const s=[],r=new Map,i=this.doc;let o="",a=this._start;function c(){if(o.length>0){const t={};let e=!1;r.forEach(((n,s)=>{e=!0,t[s]=n}));const n={insert:o};e&&(n.attributes=t),s.push(n),o=""}}const l=()=>{for(;null!==a;){if(nn(a,t)||void 0!==e&&nn(a,e))switch(a.content.constructor){case js:{const s=r.get("ychange");void 0===t||nn(a,t)?void 0===e||nn(a,e)?void 0!==s&&(c(),r.delete("ychange")):void 0!==s&&s.user===a.id.client&&"added"===s.type||(c(),r.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==s&&s.user===a.id.client&&"removed"===s.type||(c(),r.set("ychange",n?n("removed",a.id):{type:"removed"})),o+=a.content.str;break}case Js:case Bs:{c();const t={insert:a.content.getContent()[0]};if(r.size>0){const e={};t.attributes=e,r.forEach(((t,n)=>{e[n]=t}))}s.push(t);break}case $s:nn(a,t)&&(c(),fs(r,a.content))}a=a.right}c()};return t||e?kn(i,(n=>{t&&sn(n,t),e&&sn(n,e),l()}),"cleanup"):l(),s}insert(t,e,n){if(e.length<=0)return;const s=this.doc;null!==s?kn(s,(s=>{const r=us(s,this,t);n||(n={},r.currentAttributes.forEach(((t,e)=>{n[e]=t}))),ys(s,this,r,e,n)})):this._pending.push((()=>this.insert(t,e,n)))}insertEmbed(t,e,n={}){const s=this.doc;null!==s?kn(s,(s=>{const r=us(s,this,t);ys(s,this,r,e,n)})):this._pending.push((()=>this.insertEmbed(t,e,n)))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?kn(n,(n=>{vs(n,us(n,this,t),e)})):this._pending.push((()=>this.delete(t,e)))}format(t,e,n){if(0===e)return;const s=this.doc;null!==s?kn(s,(s=>{const r=us(s,this,t);null!==r.right&&bs(s,this,r,e,n)})):this._pending.push((()=>this.format(t,e,n)))}removeAttribute(t){null!==this.doc?kn(this.doc,(e=>{Zn(e,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,e){null!==this.doc?kn(this.doc,(n=>{ts(n,this,t,e)})):this._pending.push((()=>this.setAttribute(t,e)))}getAttribute(t){return es(this,t)}getAttributes(){return ns(this)}_write(t){t.writeTypeRef(Ks)}}class xs{constructor(t,e=(()=>!0)){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==Cs&&e.constructor!==Es||null===e._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Es extends Fn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Es}clone(){const t=new Es;return t.insert(0,this.toArray().map((t=>t instanceof Fn?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new xs(this,t)}querySelector(t){t=t.toUpperCase();const e=new xs(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),h(new xs(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)))}_callObserver(t,e){Un(this,t,new _s(this,e,t))}toString(){return zn(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const s=t.createDocumentFragment();return void 0!==n&&n._createAssociation(s,this),qn(this,(r=>{s.insertBefore(r.toDOM(t,e,n),null)})),s}insert(t,e){null!==this.doc?kn(this.doc,(n=>{Yn(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)kn(this.doc,(n=>{const s=t&&t instanceof Fn?t._item:t;Qn(n,this,s,e)}));else{const n=this._prelimContent,s=null===t?0:n.findIndex((e=>e===t))+1;if(0===s&&null!==t)throw kt("Reference item not found");n.splice(s,0,...e)}}delete(t,e=1){null!==this.doc?kn(this.doc,(n=>{Xn(n,this,t,e)})):this._prelimContent.splice(t,e)}toArray(){return Wn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Jn(this,t)}slice(t=0,e=this.length){return Kn(this,t,e)}forEach(t){qn(this,t)}_write(t){t.writeTypeRef(qs)}}class Cs extends Es{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach(((t,e)=>{this.setAttribute(e,t)})),this._prelimAttrs=null}_copy(){return new Cs(this.nodeName)}clone(){const t=new Cs(this.nodeName);return((t,e)=>{for(const n in t)e(t[n],n)})(this.getAttributes(),((e,n)=>{"string"==typeof e&&t.setAttribute(n,e)})),t.insert(0,this.toArray().map((t=>t instanceof Fn?t.clone():t))),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const e in t)n.push(e);n.sort();const s=n.length;for(let r=0;r<s;r++){const s=n[r];e.push(s+'="'+t[s]+'"')}const r=this.nodeName.toLocaleLowerCase();return`<${r}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${r}>`}removeAttribute(t){null!==this.doc?kn(this.doc,(e=>{Zn(e,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?kn(this.doc,(n=>{ts(n,this,t,e)})):this._prelimAttrs.set(t,e)}getAttribute(t){return es(this,t)}hasAttribute(t){return ss(this,t)}getAttributes(){return ns(this)}toDOM(t=document,e={},n){const s=t.createElement(this.nodeName),r=this.getAttributes();for(const t in r){const e=r[t];"string"==typeof e&&s.setAttribute(t,e)}return qn(this,(r=>{s.appendChild(r.toDOM(t,e,n))})),void 0!==n&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ws),t.writeKey(this.nodeName)}}class _s extends Mn{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class Ts extends cs{constructor(t){super(),this.hookName=t}_copy(){return new Ts(this.hookName)}clone(){const t=new Ts(this.hookName);return this.forEach(((e,n)=>{t.set(n,e)})),t}toDOM(t=document,e={},n){const s=e[this.hookName];let r;return r=void 0!==s?s.createDom(this):document.createElement(this.hookName),r.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(zs),t.writeKey(this.hookName)}}class As extends ks{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new As}clone(){const t=new As;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const s=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(s,this),s}toString(){return this.toDelta().map((t=>{const e=[];for(const n in t.attributes){const s=[];for(const e in t.attributes[n])s.push({key:e,value:t.attributes[n][e]});s.sort(((t,e)=>t.key<e.key?-1:1)),e.push({nodeName:n,attrs:s})}e.sort(((t,e)=>t.nodeName<e.nodeName?-1:1));let n="";for(let t=0;t<e.length;t++){const s=e[t];n+=`<${s.nodeName}`;for(let t=0;t<s.attrs.length;t++){const e=s.attrs[t];n+=` ${e.key}="${e.value}"`}n+=">"}n+=t.insert;for(let t=e.length-1;t>=0;t--)n+=`</${e[t].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Vs)}}class Is{constructor(t,e){this.id=t,this.length=e}get deleted(){throw xt()}mergeWith(t){return!1}write(t,e,n){throw xt()}integrate(t,e){throw xt()}}class Ps extends Is{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),cn(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Ds{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ds(this.content)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Os{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Os(this.len)}splice(t){const e=new Os(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){be(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ls=(t,e)=>new Ce({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Ms{constructor(t){t._item,this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ms(Ls(this.doc.guid,this.opts))}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class Bs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Bs(this.embed)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class $s{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new $s(this.key,this.value)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class Ns{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ns(this.arr)}splice(t){const e=new Ns(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let s=e;s<n;s++){const e=this.arr[s];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}class Rs{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Rs(this.arr)}splice(t){const e=new Rs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let s=e;s<n;s++){const e=this.arr[s];t.writeAny(e)}}getRef(){return 8}}class js{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new js(this.str)}splice(t){const e=new js(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const Hs=[t=>new os,t=>new cs,t=>new ks,t=>new Cs(t.readKey()),t=>new Es,t=>new Ts(t.readKey()),t=>new As],Us=0,Fs=1,Ks=2,Ws=3,qs=4,zs=5,Vs=6;class Js{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Js(this.type._copy())}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach((e=>{e.deleted?t._mergeStructs.push(e):e.delete(t)})),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach((e=>{for(;null!==e;)e.gc(t,!0),e=e.left})),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Qs=(t,e,n)=>{const{client:s,clock:r}=e.id,i=new Gs(Xe(s,r+n),e,Xe(s,r+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),null!==e.redone&&(i.redone=Xe(e.redone.client,e.redone.clock+n)),e.right=i,null!==i.right&&(i.right.left=i),t._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Gs extends Is{constructor(t,e,n,s,r,i,o,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=s,this.rightOrigin=r,this.parent=i,this.parentSub=o,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=an(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=an(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ge&&this.id.client!==this.parent.client&&this.parent.clock>=an(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=pn(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=un(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Ps||this.right&&this.right.constructor===Ps)&&(this.parent=null),this.parent){if(this.parent.constructor===Ge){const t=hn(e,this.parent);t.constructor===Ps?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Gs&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Gs&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=pn(t,t.doc.store,Xe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const s=new Set,r=new Set;for(;null!==e&&e!==this.right;){if(r.add(e),s.add(e),Ye(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,s.clear();else if(Ye(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!r.has(hn(t.doc.store,e.origin)))break;s.has(hn(t.doc.store,e.origin))||(n=e,s.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),cn(t.doc.store,this),this.content.integrate(t,this),yn(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new Ps(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:Xe(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ye(t.origin,this.lastId)&&this.right===t&&Ye(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach((e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),be(t.deleteSet,this.id.client,this.id.clock,this.length),yn(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw Et();this.content.gc(t),e?((t,e,n)=>{const s=t.clients.get(e.id.client);s[ln(s,e.id.clock)]=n})(t,this,new Ps(this.id,this.length)):this.content=new Os(this.length)}write(t,e){const n=e>0?Xe(this.id.client,this.id.clock+e-1):this.origin,s=this.rightOrigin,r=this.parentSub,i=31&this.content.getRef()|(null===n?0:G)|(null===s?0:Q)|(null===r?0:32);if(t.writeInfo(i),null!==n&&t.writeLeftID(n),null!==s&&t.writeRightID(s),null===n&&null===s){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=Ze(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===Ge?(t.writeParentInfo(!1),t.writeLeftID(e)):Et();null!==r&&t.writeString(r)}this.content.write(t,e)}}const Ys=(t,e)=>Xs[31&e](t),Xs=[()=>{Et()},t=>new Os(t.readLen()),t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new Ns(n)},t=>new Ds(t.readBuf()),t=>new js(t.readString()),t=>new Bs(t.readJSON()),t=>new $s(t.readKey(),t.readJSON()),t=>new Js(Hs[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++)n.push(t.readAny());return new Rs(n)},t=>new Ms(Ls(t.readString(),t.readAny())),()=>{Et()}];class Zs extends Is{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){Et()}write(t,e){t.writeInfo(10),ot(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const tr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};tr["__ $YJS$ __"],tr["__ $YJS$ __"]=!0;const er=new Map;const nr="undefined"==typeof BroadcastChannel?class{constructor(t){var e;this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&null!==this.onmessage&&this.onmessage({data:J(e.newValue||"")}),e=this._onChange,T||addEventListener("storage",e)}postMessage(t){A.setItem(this.room,V(new Uint8Array(t)))}close(){var t;t=this._onChange,T||removeEventListener("storage",t)}}:BroadcastChannel,sr=t=>o(er,t,(()=>{const e=a(),n=new nr(t);return n.onmessage=t=>e.forEach((e=>e(t.data,"broadcastchannel"))),{bc:n,subs:e}})),rr=(t,e,n=null)=>{const s=sr(t);s.bc.postMessage(e),s.subs.forEach((t=>t(e,n)))},ir=3e4;class or extends u{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const t=Xt();null!==this.getLocalState()&&15e3<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach(((n,s)=>{s!==this.clientID&&ir<=t-n.lastUpdated&&this.states.has(s)&&e.push(s)})),e.length>0&&ar(this,e,"timeout")}),p(3e3)),t.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),s=void 0===n?0:n.clock+1,r=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:s,lastUpdated:Xt()});const i=[],o=[],a=[],c=[];null===t?c.push(e):null==r?null!=t&&i.push(e):(o.push(e),B(r,t)||a.push(e)),(i.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:i,updated:a,removed:c},"local"]),this.emit("update",[{added:i,updated:o,removed:c},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const ar=(t,e,n)=>{const s=[];for(let n=0;n<e.length;n++){const r=e[n];if(t.states.has(r)){if(t.states.delete(r),r===t.clientID){const e=t.meta.get(r);t.meta.set(r,{clock:e.clock+1,lastUpdated:Xt()})}s.push(r)}}s.length>0&&(t.emit("change",[{added:[],updated:[],removed:s},n]),t.emit("update",[{added:[],updated:[],removed:s},n]))},cr=(t,e,n=t.states)=>{const s=e.length,r=nt();ot(r,s);for(let i=0;i<s;i++){const s=e[i],o=n.get(s)||null,a=t.meta.get(s).clock;ot(r,s),ot(r,a),ht(r,JSON.stringify(o))}return st(r)},lr=(t,e,n)=>{const s=At(e),r=Xt(),i=[],o=[],a=[],c=[],l=Lt(s);for(let e=0;e<l;e++){const e=Lt(s);let n=Lt(s);const l=JSON.parse(Bt(s)),h=t.meta.get(e),d=t.states.get(e),u=void 0===h?0:h.clock;(u<n||u===n&&null===l&&t.states.has(e))&&(null===l?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,l),t.meta.set(e,{clock:n,lastUpdated:r}),void 0===h&&null!==l?i.push(e):void 0!==h&&null===l?c.push(e):null!==l&&(B(l,d)||a.push(e),o.push(e)))}(i.length>0||a.length>0||c.length>0)&&t.emit("change",[{added:i,updated:a,removed:c},n]),(i.length>0||o.length>0||c.length>0)&&t.emit("update",[{added:i,updated:o,removed:c},n])},hr=Object.create(null);hr.open="0",hr.close="1",hr.ping="2",hr.pong="3",hr.message="4",hr.upgrade="5",hr.noop="6";const dr=Object.create(null);Object.keys(hr).forEach((t=>{dr[hr[t]]=t}));const ur={type:"error",data:"parser error"},pr="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),fr="function"==typeof ArrayBuffer,gr=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+(t||""))},n.readAsDataURL(t)},mr=({type:t,data:e},n,s)=>{return pr&&e instanceof Blob?n?s(e):gr(e,s):fr&&(e instanceof ArrayBuffer||(r=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?n?s(e):gr(new Blob([e]),s):s(hr[t]+(e||""));var r},yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",br="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<yr.length;t++)br[yr.charCodeAt(t)]=t;const wr="function"==typeof ArrayBuffer,vr=(t,e)=>{if(wr){const n=(t=>{let e,n,s,r,i,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const l=new ArrayBuffer(o),h=new Uint8Array(l);for(e=0;e<a;e+=4)n=br[t.charCodeAt(e)],s=br[t.charCodeAt(e+1)],r=br[t.charCodeAt(e+2)],i=br[t.charCodeAt(e+3)],h[c++]=n<<2|s>>4,h[c++]=(15&s)<<4|r>>2,h[c++]=(3&r)<<6|63&i;return l})(t);return Sr(n,e)}return{base64:!0,data:t}},Sr=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t,kr=(t,e)=>{if("string"!=typeof t)return{type:"message",data:Sr(t,e)};const n=t.charAt(0);if("b"===n)return{type:"message",data:vr(t.substring(1),e)};return dr[n]?t.length>1?{type:dr[n],data:t.substring(1)}:{type:dr[n]}:ur},xr=String.fromCharCode(30);function Er(t){if(t)return function(t){for(var e in Er.prototype)t[e]=Er.prototype[e];return t}(t)}Er.prototype.on=Er.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Er.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},Er.prototype.off=Er.prototype.removeListener=Er.prototype.removeAllListeners=Er.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r=0;r<s.length;r++)if((n=s[r])===e||n.fn===e){s.splice(r,1);break}return 0===s.length&&delete this._callbacks["$"+t],this},Er.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(n){s=0;for(var r=(n=n.slice(0)).length;s<r;++s)n[s].apply(this,e)}return this},Er.prototype.emitReserved=Er.prototype.emit,Er.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Er.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Cr="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function _r(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}const Tr=Cr.setTimeout,Ar=Cr.clearTimeout;function Ir(t,e){e.useNativeTimers?(t.setTimeoutFn=Tr.bind(Cr),t.clearTimeoutFn=Ar.bind(Cr)):(t.setTimeoutFn=Cr.setTimeout.bind(Cr),t.clearTimeoutFn=Cr.clearTimeout.bind(Cr))}class Pr extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}class Dr extends Er{constructor(t){super(),this.writable=!1,Ir(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,n){return super.emitReserved("error",new Pr(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=kr(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const Or="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Lr={};let Mr,Br=0,$r=0;function Nr(t){let e="";do{e=Or[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function Rr(){const t=Nr(+new Date);return t!==Mr?(Br=0,Mr=t):t+"."+Nr(Br++)}for(;$r<64;$r++)Lr[Or[$r]]=$r;function jr(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}let Hr=!1;try{Hr="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const Ur=Hr;function Fr(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Ur))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Cr[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function Kr(){}const Wr=null!=new Fr({xdomain:!1}).responseType;class qr extends Er{constructor(t,e){super(),Ir(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=_r(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new Fr(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=qr.requestsCount++,qr.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Kr,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete qr.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(qr.requestsCount=0,qr.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",zr);else if("function"==typeof addEventListener){addEventListener("onpagehide"in Cr?"pagehide":"unload",zr,!1)}function zr(){for(let t in qr.requests)qr.requests.hasOwnProperty(t)&&qr.requests[t].abort()}const Vr="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Jr=Cr.WebSocket||Cr.MozWebSocket,Qr="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Gr={websocket:class extends Dr{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,n=Qr?{}:_r(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Qr?new Jr(t,e,n):e?new Jr(t,e):new Jr(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],s=e===t.length-1;mr(n,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}s&&Vr((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Rr()),this.supportsBinary||(t.b64=1);const s=jr(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!Jr}},polling:class extends Dr{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=Wr&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const n=t.split(xr),s=[];for(let t=0;t<n.length;t++){const r=kr(n[t],e);if(s.push(r),"error"===r.type)break}return s})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const n=t.length,s=new Array(n);let r=0;t.forEach(((t,i)=>{mr(t,!1,(t=>{s[i]=t,++r===n&&e(s.join(xr))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Rr()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const s=jr(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new qr(this.uri(),t)}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Yr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Zr(t){const e=t,n=t.indexOf("["),s=t.indexOf("]");-1!=n&&-1!=s&&(t=t.substring(0,n)+t.substring(n,s).replace(/:/g,";")+t.substring(s,t.length));let r=Yr.exec(t||""),i={},o=14;for(;o--;)i[Xr[o]]=r[o]||"";return-1!=n&&-1!=s&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const n=/\/{2,9}/g,s=e.replace(n,"/").split("/");"/"!=e.slice(0,1)&&0!==e.length||s.splice(0,1);"/"==e.slice(-1)&&s.splice(s.length-1,1);return s}(0,i.path),i.queryKey=function(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,s){e&&(n[e]=s)})),n}(0,i.query),i}class ti extends Er{constructor(t,e={}){super(),this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=Zr(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Zr(e.host).host),Ir(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},n=t.split("&");for(let t=0,s=n.length;t<s;t++){let s=n[t].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Gr[t](n)}open(){let t;if(this.opts.rememberUpgrade&&ti.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),n=!1;ti.priorWebsocketSuccess=!1;const s=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;ti.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function r(){n||(n=!0,l(),e.close(),e=null)}const i=t=>{const n=new Error("probe error: "+t);n.transport=e.name,r(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&r()}const l=()=>{e.removeListener("open",s),e.removeListener("error",i),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",s),e.once("error",i),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",ti.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+="string"==typeof(e=s)?function(t){let e=0,n=0;for(let s=0,r=t.length;s<r;s++)e=t.charCodeAt(s),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(s++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}var e;return this.writeBuffer}write(t,e,n){return this.sendPacket("message",t,e,n),this}send(t,e,n){return this.sendPacket("message",t,e,n),this}sendPacket(t,e,n,s){if("function"==typeof e&&(s=e,e=void 0),"function"==typeof n&&(s=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:t,data:e,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),s&&this.once("flush",s),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}onError(t){ti.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let n=0;const s=t.length;for(;n<s;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}ti.protocol=4;ti.protocol;const ei="function"==typeof ArrayBuffer,ni=Object.prototype.toString,si="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ni.call(Blob),ri="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ni.call(File);function ii(t){return ei&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||si&&t instanceof Blob||ri&&t instanceof File}function oi(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(oi(t[e]))return!0;return!1}if(ii(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return oi(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&oi(t[e]))return!0;return!1}function ai(t){const e=[],n=t.data,s=t;return s.data=ci(n,e),s.attachments=e.length,{packet:s,buffers:e}}function ci(t,e){if(!t)return t;if(ii(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=ci(t[s],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=ci(t[s],e));return n}return t}function li(t,e){return t.data=hi(t.data,e),delete t.attachments,t}function hi(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=hi(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=hi(t[n],e));return t}const di=5;var ui;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(ui||(ui={}));class pi{constructor(t){this.replacer=t}encode(t){return t.type!==ui.EVENT&&t.type!==ui.ACK||!oi(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===ui.EVENT?ui.BINARY_EVENT:ui.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==ui.BINARY_EVENT&&t.type!==ui.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=ai(t),n=this.encodeAsString(e.packet),s=e.buffers;return s.unshift(n),s}}class fi extends Er{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===ui.BINARY_EVENT;n||e.type===ui.BINARY_ACK?(e.type=n?ui.EVENT:ui.ACK,this.reconstructor=new gi(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!ii(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===ui[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ui.BINARY_EVENT||n.type===ui.BINARY_ACK){const s=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const r=t.substring(s,e);if(r!=Number(r)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===t.charAt(e+1)){const s=e+1;for(;++e;){if(","===t.charAt(e))break;if(e===t.length)break}n.nsp=t.substring(s,e)}else n.nsp="/";const s=t.charAt(e+1);if(""!==s&&Number(s)==s){const s=e+1;for(;++e;){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(s,e+1))}if(t.charAt(++e)){const s=this.tryParse(t.substr(e));if(!fi.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case ui.CONNECT:return"object"==typeof e;case ui.DISCONNECT:return void 0===e;case ui.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case ui.EVENT:case ui.BINARY_EVENT:return Array.isArray(e)&&("string"==typeof e[0]||"number"==typeof e[0]);case ui.ACK:case ui.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class gi{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=li(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function mi(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const yi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class bi extends Er{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[mi(t,"open",this.onopen.bind(this)),mi(t,"packet",this.onpacket.bind(this)),mi(t,"error",this.onerror.bind(this)),mi(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(yi.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const n={type:ui.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,s=e.pop();this._registerAckCallback(t,s),n.id=t}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(t,e){var n;const s=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===s)return void(this.acks[t]=e);const r=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),s);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(r),e.apply(this,[null,...t])}}emitWithAck(t,...e){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((s,r)=>{e.push(((t,e)=>n?t?r(t):s(e):s(t))),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...s)=>{if(n!==this._queue[0])return;return null!==t?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...s)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ui.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ui.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ui.EVENT:case ui.BINARY_EVENT:this.onevent(t);break;case ui.ACK:case ui.BINARY_ACK:this.onack(t);break;case ui.DISCONNECT:this.ondisconnect();break;case ui.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...s){n||(n=!0,e.packet({type:ui.ACK,id:t,data:s}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ui.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function wi(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}wi.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},wi.prototype.reset=function(){this.attempts=0},wi.prototype.setMin=function(t){this.ms=t},wi.prototype.setMax=function(t){this.max=t},wi.prototype.setJitter=function(t){this.jitter=t};class vi extends Er{constructor(e,n){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(n=e,e=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,Ir(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=n.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new wi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=e;const r=n.parser||t;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ti(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=mi(e,"open",(function(){n.onopen(),t&&t()})),r=mi(e,"error",(e=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",e),t?t(e):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&s();const n=this.setTimeoutFn((()=>{s(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(s),this.subs.push(r),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(mi(t,"ping",this.onping.bind(this)),mi(t,"data",this.ondata.bind(this)),mi(t,"error",this.onerror.bind(this)),mi(t,"close",this.onclose.bind(this)),mi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){Vr((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new bi(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const t of e){if(this.nsps[t].active)return}this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Si={};function ki(t,e){"object"==typeof t&&(e=t,t=void 0);const n=function(t,e="",n){let s=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),s=Zr(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(n&&n.port===s.port?"":":"+s.port),s}(t,(e=e||{}).path||"/socket.io"),s=n.source,r=n.id,i=n.path,o=Si[r]&&i in Si[r].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new vi(s,e):(Si[r]||(Si[r]=new vi(s,e)),a=Si[r]),n.query&&!e.query&&(e.query=n.queryKey),a.socket(n.path,e)}Object.assign(ki,{Manager:vi,Socket:bi,io:ki,connect:ki});var xi=class extends u{constructor(t,e,n=new Ce,{autoConnect:s=!0,awareness:r=new or(n),resyncInterval:i=-1,disableBc:o=!1,auth:a={}}){for(super(),this.bcconnected=!1,this._synced=!1,this.resyncInterval=null,this.initSyncListeners=()=>{this.socket.on("sync-step-1",((t,e)=>{e(je(this.doc,new Uint8Array(t))),this.synced=!0})),this.socket.on("sync-update",this.onSocketSyncUpdate)},this.initAwarenessListeners=()=>{this.socket.on("awareness-update",(t=>{lr(this.awareness,new Uint8Array(t),this)}))},this.initSystemListeners=()=>{"undefined"!=typeof window?window.addEventListener("beforeunload",this.beforeUnloadHandler):"undefined"!=typeof process&&process.on("exit",this.beforeUnloadHandler)},this.onSocketConnection=(t=-1)=>{this.emit("status",[{status:"connected"}]),this.socket.emit("sync-step-1",We(this.doc),(t=>{Ne(this.doc,new Uint8Array(t),this)})),null!==this.awareness.getLocalState()&&this.socket.emit("awareness-update",cr(this.awareness,[this.doc.clientID])),t>0&&(this.resyncInterval=setInterval((()=>{this.socket.disconnected||this.socket.emit("sync-step-1",We(this.doc),(t=>{Ne(this.doc,new Uint8Array(t),this)}))}),t))},this.onSocketDisconnection=t=>{this.emit("connection-close",[t,this]),this.synced=!1,ar(this.awareness,Array.from(this.awareness.getStates().keys()).filter((t=>t!==this.doc.clientID)),this),this.emit("status",[{status:"disconnected"}])},this.onSocketConnectionError=t=>{this.emit("connection-error",[t,this])},this.onUpdateDoc=(t,e)=>{e!==this&&(this.socket.emit("sync-update",t),this.bcconnected&&rr(this._broadcastChannel,{type:"sync-update",data:t},this))},this.onSocketSyncUpdate=t=>{Ne(this.doc,new Uint8Array(t),this)},this.awarenessUpdate=({added:t,updated:e,removed:n},s)=>{let r=t.concat(e).concat(n);this.socket.emit("awareness-update",cr(this.awareness,r)),this.bcconnected&&rr(this._broadcastChannel,{type:"awareness-update",data:cr(this.awareness,r)},this)},this.beforeUnloadHandler=()=>{ar(this.awareness,[this.doc.clientID],"window unload")},this.connectBc=()=>{this.bcconnected||(((t,e)=>{sr(t).subs.add(e)})(this._broadcastChannel,this.onBroadcastChannelMessage),this.bcconnected=!0),rr(this._broadcastChannel,{type:"sync-step-1",data:We(this.doc)},this),rr(this._broadcastChannel,{type:"sync-step-2",data:je(this.doc)},this),rr(this._broadcastChannel,{type:"query-awareness",data:null},this),rr(this._broadcastChannel,{type:"awareness-update",data:cr(this.awareness,[this.doc.clientID])},this)},this.disconnectBc=()=>{rr(this._broadcastChannel,{type:"awareness-update",data:cr(this.awareness,[this.doc.clientID],new Map)},this),this.bcconnected&&(((t,e)=>{const n=sr(t),s=n.subs.delete(e);s&&0===n.subs.size&&(n.bc.close(),er.delete(t))})(this._broadcastChannel,this.onBroadcastChannelMessage),this.bcconnected=!1)},this.onBroadcastChannelMessage=(t,e)=>{if(e!==this&&t.type.length>0)switch(t.type){case"sync-step-1":rr(this._broadcastChannel,{type:"sync-step-2",data:je(this.doc,t.data)},this);break;case"sync-step-2":case"sync-update":Ne(this.doc,new Uint8Array(t.data),this);break;case"query-awareness":rr(this._broadcastChannel,{type:"awareness-update",data:cr(this.awareness,Array.from(this.awareness.getStates().keys()))},this);break;case"awareness-update":lr(this.awareness,new Uint8Array(t.data),this)}};"/"===t[t.length-1];)t=t.slice(0,t.length-1);this._url=t,this.roomName=e,this.doc=n,this.awareness=r,this._broadcastChannel=`${t}/${e}`,this.disableBc=o,this.socket=ki(`${this.url}/yjs|${e}`,{autoConnect:!1,transports:["websocket"],forceNew:!0,auth:a}),this.doc.on("update",this.onUpdateDoc),this.socket.on("connect",(()=>this.onSocketConnection(i))),this.socket.on("disconnect",(t=>this.onSocketDisconnection(t))),this.socket.on("connect_error",(t=>this.onSocketConnectionError(t))),this.initSyncListeners(),this.initAwarenessListeners(),this.initSystemListeners(),r.on("update",this.awarenessUpdate),s&&this.connect()}get broadcastChannel(){return this._broadcastChannel}get url(){return this._url}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}connect(){this.socket.connected||(this.emit("status",[{status:"connecting"}]),this.socket.connect(),this.disableBc||this.connectBc(),this.synced=!1)}disconnect(){this.socket.connected&&(this.disconnectBc(),this.socket.disconnect())}destroy(){null!=this.resyncInterval&&clearInterval(this.resyncInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this.beforeUnloadHandler):"undefined"!=typeof process&&process.off("exit",this.beforeUnloadHandler),this.awareness.off("update",this.awarenessUpdate),this.doc.off("update",this.onUpdateDoc),super.destroy()}},Ei=H5P.jQuery,Ci=H5P.EventDispatcher,_i=H5P.JoubelUI,Ti=function(t){return t.concat.apply([],t)},Ai=function(t){return"function"==typeof t},Ii=null!==navigator.userAgent.match(/iPad/i),Pi=null!==navigator.userAgent.match(/iPad|iPod|iPhone/i),Di=function(t,e){return-1!==t.indexOf(e)},Oi=function(t,e){return void 0!==t?t:e},Li=13,Mi=27,Bi=32,$i=function(t,e,n){t.click((function(t){e.call(n||this,t)})),t.keydown((function(t){Di([Li,Bi],t.which)&&(t.preventDefault(),e.call(n||this,t))}))},Ni=Ei("<div>"),Ri=function(){function t(t,e){this.$summarySlide=e,this.cp=t}return t.prototype.updateSummarySlide=function(t,e){var n=this,s=void 0===this.cp.editor&&void 0!==this.$summarySlide&&t>=this.cp.slides.length-1,r=!this.cp.showSummarySlide&&this.cp.hasAnswerElements;if(s){n.cp.presentation.keywordListEnabled&&n.cp.presentation.keywordListAlwaysShow&&n.cp.hideKeywords(),this.$summarySlide.children().remove();var i=n.cp.getSlideScores(e),o=n.outputScoreStats(i);if(Ei(o).appendTo(n.$summarySlide),!r){var a=n.totalScores(i);if(!isNaN(a.totalPercentage)){var c=_i.createScoreBar(a.totalMaxScore,"","","");c.setScore(a.totalScore);var l=Ei(".h5p-summary-total-score",n.$summarySlide);c.appendTo(l),setTimeout((function(){l.append(Ei("<div/>",{"aria-live":"polite",class:"hidden-but-read",html:n.cp.l10n.summary+". "+n.cp.l10n.accessibilityTotalScore.replace("@score",a.totalScore).replace("@maxScore",a.totalMaxScore)}))}),100)}if(1==n.cp.enableTwitterShare){var h=Ei(".h5p-summary-twitter-message",n.$summarySlide);this.addTwitterScoreLinkTo(h,a)}if(1==n.cp.enableFacebookShare){var d=Ei(".h5p-summary-facebook-message",n.$summarySlide);this.addFacebookScoreLinkTo(d,a)}if(1==n.cp.enableGoogleShare){var u=Ei(".h5p-summary-google-message",n.$summarySlide);this.addGoogleScoreLinkTo(u)}n.$summarySlide.find(".h5p-td > .h5p-slide-link").each((function(){var t=Ei(this);t.click((function(e){n.cp.jumpToSlide(parseInt(t.data("slide"),10)-1),e.preventDefault()}))}))}var p=Ei(".h5p-summary-footer",n.$summarySlide);this.cp.showSummarySlideSolutionButton&&_i.createButton({class:"h5p-show-solutions",html:n.cp.l10n.showSolutions,on:{click:function(){n.toggleSolutionMode(!0)}},appendTo:p}),this.cp.showSummarySlideRetryButton&&_i.createButton({class:"h5p-cp-retry-button",html:n.cp.l10n.retry,on:{click:function(){n.cp.resetTask()}},appendTo:p}),n.cp.hasAnswerElements&&_i.createButton({class:"h5p-eta-export",html:n.cp.l10n.exportAnswers,on:{click:function(){H5P.ExportableTextArea.Exporter.run(n.cp.slides,n.cp.elementInstances)}},appendTo:p})}},t.prototype.outputScoreStats=function(t){if(void 0===t)return this.$summarySlide.addClass("h5p-summary-only-export"),'<div class="h5p-summary-footer"></div>';var e,n=this,s=0,r=0,i="",o=0,a="";for(e=0;e<t.length;e+=1)a=this.getSlideDescription(t[e]),o=Math.round(t[e].score/t[e].maxScore*100),isNaN(o)&&(o=0),i+='<tr><td class="h5p-td h5p-summary-task-title"><a href="#" class="h5p-slide-link"  aria-label=" '+n.cp.l10n.slide+" "+t[e].slide+": "+a.replace(/(<([^>]+)>)/gi,"")+" "+o+'%" data-slide="'+t[e].slide+'">'+n.cp.l10n.slide+" "+t[e].slide+": "+a.replace(/(<([^>]+)>)/gi,"")+'</a></td><td class="h5p-td h5p-summary-score-bar"><p class="hidden-but-read">'+o+"%</p><p>"+t[e].score+"<span>/</span>"+t[e].maxScore+"</p></td></tr>",s+=t[e].score,r+=t[e].maxScore;this.cp.isSolutionMode||n.cp.triggerXAPICompleted(s,r);var c=n.cp.enableTwitterShare||n.cp.enableFacebookShare||n.cp.enableGoogleShare?'<span class="h5p-show-results-text">'+n.cp.l10n.shareResult+"</span>":"",l=1==n.cp.enableTwitterShare?'<span class="h5p-summary-twitter-message" aria-label="'+n.cp.l10n.shareTwitter+'"></span>':"",h=1==n.cp.enableFacebookShare?'<span class="h5p-summary-facebook-message" aria-label="'+n.cp.l10n.shareFacebook+'"></span>':"",d=1==n.cp.enableGoogleShare?'<span class="h5p-summary-google-message" aria-label="'+n.cp.l10n.shareGoogle+'"></span>':"";return'<div class="h5p-summary-table-holder"><div class="h5p-summary-table-pages"><table class="h5p-score-table"><thead><tr><th class="h5p-summary-table-header slide">'+n.cp.l10n.slide+'</th><th class="h5p-summary-table-header score">'+n.cp.l10n.score+"<span>/</span>"+n.cp.l10n.total.toLowerCase()+"</th></tr></thead><tbody>"+i+'</tbody></table></div><div class="h5p-summary-total-table"><div class="h5p-summary-social">'+c+h+l+d+'</div><div class="h5p-summary-total-score"><p>'+n.cp.l10n.totalScore+'</p></div></div></div><div class="h5p-summary-footer"></div>'},t.prototype.getSlideDescription=function(t){var e,n,s=this,r=s.cp.slides[t.slide-1].elements;if(t.indexes.length>1)e=s.cp.l10n.summaryMultipleTaskText;else if(void 0!==r[t.indexes[0]]&&r[0])if(n=r[t.indexes[0]].action,"function"==typeof s.cp.elementInstances[t.slide-1][t.indexes[0]].getTitle)e=s.cp.elementInstances[t.slide-1][t.indexes[0]].getTitle();else if(void 0!==n.library&&n.library){var i=n.library.split(" ")[0].split(".")[1].split(/(?=[A-Z])/),o="";i.forEach((function(t,e){0!==e&&(t=t.toLowerCase()),o+=t,e<=i.length-1&&(o+=" ")})),e=o}return e},t.prototype.addTwitterScoreLinkTo=function(t,e){var n=this,s=n.cp.twitterShareStatement||"",r=n.cp.twitterShareHashtags||"",i=n.cp.twitterShareUrl||"";i=i.replace("@currentpageurl",window.location.href),s=s.replace("@score",e.totalScore).replace("@maxScore",e.totalMaxScore).replace("@percentage",e.totalPercentage+"%").replace("@currentpageurl",window.location.href),r=r.trim().replace(" ",""),s=encodeURIComponent(s),r=encodeURIComponent(r),i=encodeURIComponent(i);var o="https://twitter.com/intent/tweet?";o+=s.length>0?"text="+s+"&":"",o+=i.length>0?"url="+i+"&":"",o+=r.length>0?"hashtags="+r:"";var a=window.innerWidth/2,c=window.innerHeight/2;t.attr("tabindex","0").attr("role","button"),$i(t,(function(){return window.open(o,n.cp.l10n.shareTwitter,"width=800,height=300,left="+a+",top="+c),!1}))},t.prototype.addFacebookScoreLinkTo=function(t,e){var n=this,s=n.cp.facebookShareUrl||"",r=n.cp.facebookShareQuote||"";s=s.replace("@currentpageurl",window.location.href),r=r.replace("@currentpageurl",window.location.href).replace("@percentage",e.totalPercentage+"%").replace("@score",e.totalScore).replace("@maxScore",e.totalMaxScore),s=encodeURIComponent(s),r=encodeURIComponent(r);var i="https://www.facebook.com/sharer/sharer.php?";i+=s.length>0?"u="+s+"&":"",i+=r.length>0?"quote="+r:"";var o=window.innerWidth/2,a=window.innerHeight/2;t.attr("tabindex","0").attr("role","button"),$i(t,(function(){return window.open(i,n.cp.l10n.shareFacebook,"width=800,height=300,left="+o+",top="+a),!1}))},t.prototype.addGoogleScoreLinkTo=function(t){var e=this,n=e.cp.googleShareUrl||"";n=n.replace("@currentpageurl",window.location.href),n=encodeURIComponent(n);var s="https://plus.google.com/share?";s+=n.length>0?"url="+n:"";var r=window.innerWidth/2,i=window.innerHeight/2;t.attr("tabindex","0").attr("role","button"),$i(t,(function(){return window.open(s,e.cp.l10n.shareGoogle,"width=401,height=437,left="+r+",top="+i),!1}))},t.prototype.totalScores=function(t){if(void 0===t)return{totalScore:0,totalMaxScore:0,totalPercentage:0};var e,n=0,s=0;for(e=0;e<t.length;e+=1)n+=t[e].score,s+=t[e].maxScore;var r=Math.round(n/s*100);return isNaN(r)&&(r=0),{totalScore:n,totalMaxScore:s,totalPercentage:r}},t.prototype.toggleSolutionMode=function(t){if(this.cp.isSolutionMode=t,t){var e=this.cp.showSolutions();this.cp.setProgressBarFeedback(e),this.cp.$footer.addClass("h5p-footer-solution-mode"),this.setFooterSolutionModeText(this.cp.l10n.solutionModeText)}else this.cp.$footer.removeClass("h5p-footer-solution-mode"),this.setFooterSolutionModeText(),this.cp.setProgressBarFeedback()},t.prototype.setFooterSolutionModeText=function(t){void 0!==t&&t?this.cp.$exitSolutionModeText.html(t):this.cp.$exitSolutionModeText&&this.cp.$exitSolutionModeText.html("")},t}();const ji=Ri;var Hi=function(t){var e=0;function n(){}return n.supported=function(){return"function"==typeof window.print},n.print=function(e,n,s){e.trigger("printing",{finished:!1,allSlides:s});var r=t(".h5p-slide.h5p-current"),i=r.height(),o=r.width()/670,a=t(".h5p-slide");a.css({height:i/o+"px",width:"670px",fontSize:Math.floor(100/o)+"%"});var c=n.height();n.css("height","auto"),a.toggleClass("doprint",!0===s),r.addClass("doprint"),setTimeout((function(){window.print(),a.css({height:"",width:"",fontSize:""}),n.css("height",c+"px"),e.trigger("printing",{finished:!0})}),500)},n.showDialog=function(n,s,r){var i=this,o=e++,a="h5p-cp-print-dialog-".concat(o,"-title"),c="h5p-cp-print-dialog-".concat(o,"-ingress"),l=t('<div class="h5p-popup-dialog h5p-print-dialog">\n                      <div role="dialog" aria-labelledby="'.concat(a,'" aria-describedby="').concat(c,'" tabindex="-1" class="h5p-inner">\n                        <h2 id="').concat(a,'">').concat(n.printTitle,'</h2>\n                        <div class="h5p-scroll-content"></div>\n                        <div class="h5p-close" role="button" tabindex="0" title="').concat(H5P.t("close"),'">\n                      </div>\n                    </div>')).insertAfter(s).click((function(){i.close()})).children(".h5p-inner").click((function(){return!1})).end();$i(l.find(".h5p-close"),(function(){return i.close()}));var h=l.find(".h5p-scroll-content");return h.append(t("<div>",{class:"h5p-cp-print-ingress",id:c,html:n.printIngress})),H5P.JoubelUI.createButton({html:n.printAllSlides,class:"h5p-cp-print-all-slides",click:function(){i.close(),r(!0)}}).appendTo(h),H5P.JoubelUI.createButton({html:n.printCurrentSlide,class:"h5p-cp-print-current-slide",click:function(){i.close(),r(!1)}}).appendTo(h),this.open=function(){setTimeout((function(){l.addClass("h5p-open"),H5P.jQuery(i).trigger("dialog-opened",[l])}),1)},this.close=function(){l.removeClass("h5p-open"),setTimeout((function(){l.remove()}),200)},this.open(),l},n}(H5P.jQuery);const Ui=Hi,Fi=function(t){const e=t.length;return function n(){const s=Array.prototype.slice.call(arguments,0);return s.length>=e?t.apply(null,s):function(){const t=Array.prototype.slice.call(arguments,0);return n.apply(null,s.concat(t))}}},Ki=Fi((function(t,e){e.forEach(t)})),Wi=(Fi((function(t,e){return e.map(t)})),Fi((function(t,e){return e.filter(t)}))),qi=(Fi((function(t,e){return e.some(t)})),Fi((function(t,e){return-1!=e.indexOf(t)}))),zi=Fi((function(t,e){return Wi((e=>!qi(e,t)),e)})),Vi=Fi(((t,e)=>e.getAttribute(t))),Ji=Fi(((t,e,n)=>n.setAttribute(t,e))),Qi=Fi(((t,e)=>e.removeAttribute(t))),Gi=Fi(((t,e)=>e.hasAttribute(t))),Yi=(Fi(((t,e,n)=>n.getAttribute(t)===e)),Fi(((t,e)=>{const n=Vi(t,e);Ji(t,("true"!==n).toString(),e)})),Fi(((t,e)=>t.appendChild(e))),Fi(((t,e)=>e.querySelector(t))),Fi(((t,e)=>{return n=e.querySelectorAll(t),Array.prototype.slice.call(n);var n})),Fi(((t,e)=>t.removeChild(e))),Fi(((t,e)=>e.classList.contains(t))),Fi(((t,e)=>e.classList.add(t)))),Xi=Fi(((t,e)=>e.classList.remove(t))),Zi=Yi("hidden"),to=Xi("hidden"),eo=(Fi(((t,e)=>(t?to:Zi)(e))),Fi(((t,e,n)=>{n.classList[e?"add":"remove"](t)})),Qi("tabindex")),no=(Ki(eo),Ji("tabindex","0")),so=Ji("tabindex","-1"),ro=Gi("tabindex");class io{constructor(t){Object.assign(this,{listeners:{},on:function(t,e,n){const s={listener:e,scope:n};return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(s),this},fire:function(t,e){return(this.listeners[t]||[]).every((function(t){return!1!==t.listener.call(t.scope||this,e)}))},propagate:function(t,e){let n=this;t.forEach((t=>e.on(t,(e=>n.fire(t,e)))))}}),this.plugins=t||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.on("firstElement",this.firstElement,this),this.on("lastElement",this.lastElement,this),this.initPlugins()}addElement(t){this.elements.push(t),this.firesEvent("addElement",t),1===this.elements.length&&this.setTabbable(t)}insertElementAt(t,e){this.elements.splice(e,0,t),this.firesEvent("addElement",t),1===this.elements.length&&this.setTabbable(t)}removeElement(t){this.elements=zi([t],this.elements),ro(t)&&(this.setUntabbable(t),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",t)}count(){return this.elements.length}firesEvent(t,e){const n=this.elements.indexOf(e);return this.fire(t,{element:e,index:n,elements:this.elements,oldElement:this.tabbableElement})}nextElement({index:t}){const e=t===this.elements.length-1,n=this.elements[e?0:t+1];this.setTabbable(n),n.focus()}firstElement(){const t=this.elements[0];this.setTabbable(t),t.focus()}lastElement(){const t=this.elements[this.elements.length-1];this.setTabbable(t),t.focus()}setTabbableByIndex(t){const e=this.elements[t];e&&this.setTabbable(e)}setTabbable(t){Ki(this.setUntabbable.bind(this),this.elements),no(t),this.tabbableElement=t}setUntabbable(t){t!==document.activeElement&&(this.negativeTabIndexAllowed?so(t):eo(t))}previousElement({index:t}){const e=0===t,n=this.elements[e?this.elements.length-1:t-1];this.setTabbable(n),n.focus()}useNegativeTabIndex(){this.negativeTabIndexAllowed=!0,this.elements.forEach((t=>{t.hasAttribute("tabindex")||so(t)}))}initPlugins(){this.plugins.forEach((function(t){void 0!==t.init&&t.init(this)}),this)}}class oo{constructor(){this.selectability=!0}init(t){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=t,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}listenForKeyDown({element:t}){t.addEventListener("keydown",this.boundHandleKeyDown)}removeKeyDownListener({element:t}){t.removeEventListener("keydown",this.boundHandleKeyDown)}handleKeyDown(t){switch(t.which){case 27:this.close(t.target),t.preventDefault(),t.stopPropagation();break;case 35:this.lastElement(t.target),t.preventDefault(),t.stopPropagation();break;case 36:this.firstElement(t.target),t.preventDefault(),t.stopPropagation();break;case 13:case 32:this.select(t.target),t.preventDefault(),t.stopPropagation();break;case 37:case 38:this.hasChromevoxModifiers(t)||(this.previousElement(t.target),t.preventDefault(),t.stopPropagation());break;case 39:case 40:this.hasChromevoxModifiers(t)||(this.nextElement(t.target),t.preventDefault(),t.stopPropagation())}}hasChromevoxModifiers(t){return t.shiftKey||t.ctrlKey}previousElement(t){!1!==this.controls.firesEvent("beforePreviousElement",t)&&(this.controls.firesEvent("previousElement",t),this.controls.firesEvent("afterPreviousElement",t))}nextElement(t){!1!==this.controls.firesEvent("beforeNextElement",t)&&(this.controls.firesEvent("nextElement",t),this.controls.firesEvent("afterNextElement",t))}select(t){this.selectability&&!1!==this.controls.firesEvent("before-select",t)&&(this.controls.firesEvent("select",t),this.controls.firesEvent("after-select",t))}firstElement(t){!1!==this.controls.firesEvent("beforeFirstElement",t)&&(this.controls.firesEvent("firstElement",t),this.controls.firesEvent("afterFirstElement",t))}lastElement(t){!1!==this.controls.firesEvent("beforeLastElement",t)&&(this.controls.firesEvent("lastElement",t),this.controls.firesEvent("afterLastElement",t))}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}close(t){!1!==this.controls.firesEvent("before-close",t)&&(this.controls.firesEvent("close",t),this.controls.firesEvent("after-close",t))}}function ao(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var co="none",lo="not-answered",ho="answered",uo="has-only-correct",po="has-incorrect",fo=function(t){function e(t){var e;this.cp=t,this.answeredLabels=(ao(e={},lo,this.cp.l10n.containsNotCompleted+"."),ao(e,ho,this.cp.l10n.containsCompleted+"."),ao(e,uo,this.cp.l10n.containsOnlyCorrect+"."),ao(e,po,this.cp.l10n.containsIncorrectAnswers+"."),ao(e,co,""),e),this.initProgressbar(this.cp.slidesWithSolutions),this.initFooter(),this.initTaskAnsweredListener(),this.toggleNextAndPreviousButtonDisabled(this.cp.getCurrentSlideIndex())}return e.prototype.initTaskAnsweredListener=function(){var t=this;this.cp.elementInstances.forEach((function(e,n){e.filter((function(t){return Ai(t.on)})).forEach((function(e){e.on("xAPI",(function(e){var s=e.getVerb();if(Di(["interacted","answered","attempted"],s)){var r=t.cp.slideHasAnsweredTask(n);t.setTaskAnswered(n,r)}else"completed"===s&&e.setVerb("answered");void 0===e.data.statement.context.extensions&&(e.data.statement.context.extensions={}),e.data.statement.context.extensions["http://id.tincanapi.com/extension/ending-point"]=n+1}))}))}))},e.prototype.initProgressbar=function(e){var n=this,s=n.cp.previousState&&n.cp.previousState.progress||0;this.progresbarKeyboardControls=new io([new oo]),this.progresbarKeyboardControls.negativeTabIndexAllowed=!0,this.progresbarKeyboardControls.on("select",(function(e){n.displaySlide(t(e.element).data("slideNumber"))})),this.progresbarKeyboardControls.on("beforeNextElement",(function(t){return t.index!==t.elements.length-1})),this.progresbarKeyboardControls.on("beforePreviousElement",(function(t){return 0!==t.index})),void 0!==this.cp.progressbarParts&&this.cp.progressbarParts&&this.cp.progressbarParts.forEach((function(t){n.progresbarKeyboardControls.removeElement(t.children("a").get(0)),t.remove()})),n.cp.progressbarParts=[];for(var r=function(e){e.preventDefault();var s=t(this).data("slideNumber");n.progresbarKeyboardControls.setTabbableByIndex(s),n.displaySlide(s),n.cp.focus()},i=0;i<this.cp.slides.length;i+=1){var o=this.cp.slides[i],a=this.createSlideTitle(i),c=t("<div>",{class:"h5p-progressbar-part",id:"progressbar-part-"+i,role:"tab","aria-label":a,"aria-controls":"slide-"+i,"aria-selected":!1}).appendTo(n.cp.$progressbar),l=t("<a>",{href:"#",html:'<span class="h5p-progressbar-part-title hidden-but-read">'+a+"</span>",tabindex:"-1"}).data("slideNumber",i).click(r).appendTo(c);if(this.progresbarKeyboardControls.addElement(l.get(0)),this.isSummarySlide(i)&&c.addClass("progressbar-part-summary-slide"),Pi||H5P.Tooltip(c.get(0),{position:"top"}),0===i&&c.addClass("h5p-progressbar-part-show"),i===s&&c.addClass("h5p-progressbar-part-selected").attr("aria-selected",!0),n.cp.progressbarParts.push(c),this.updateSlideTitle(i),this.cp.slides.length<=60&&o.elements&&o.elements.length>0){var h=e[i]&&e[i].length>0,d=!!(n.cp.previousState&&n.cp.previousState.answered&&n.cp.previousState.answered[i]);h&&(t("<div>",{class:"h5p-progressbar-part-has-task"}).appendTo(l),this.setTaskAnswered(i,d))}}},e.prototype.displaySlide=function(t){var e=this;this.cp.jumpToSlide(t,!1,(function(){var n=e.cp.getCurrentSlideIndex();e.updateSlideTitle(t,{isCurrent:!0}),e.updateSlideTitle(n,{isCurrent:!1}),e.toggleNextAndPreviousButtonDisabled(t)}))},e.prototype.createSlideTitle=function(t){var e=this.cp.slides[t];return e.keywords&&e.keywords.length>0?e.keywords[0].main:this.isSummarySlide(t)?this.cp.l10n.summary:this.cp.l10n.slide+" "+(t+1)},e.prototype.isSummarySlide=function(t){return!(void 0!==this.cp.editor||t!==this.cp.slides.length-1||!this.cp.showSummarySlide)},e.prototype.initFooter=function(){var e=this,n=this,s=this.cp.$footer,r=t("<div/>",{class:"h5p-footer-left-adjusted"}).appendTo(s),i=t("<div/>",{class:"h5p-footer-center-adjusted"}).appendTo(s),o=t("<div/>",{role:"toolbar",class:"h5p-footer-right-adjusted"}).appendTo(s);this.cp.$keywordsButton=t("<div/>",{class:"h5p-footer-button h5p-footer-toggle-keywords","aria-expanded":"false","aria-label":this.cp.l10n.showKeywords,role:"button",tabindex:"0",html:'<span class="h5p-icon-menu"></span><span class="current-slide-title"></span>'}).appendTo(r),H5P.Tooltip(this.cp.$keywordsButton.get(0)),$i(this.cp.$keywordsButton,(function(t){n.cp.presentation.keywordListAlwaysShow||(n.cp.toggleKeywords(),t.stopPropagation())})),!this.cp.presentation.keywordListAlwaysShow&&this.cp.initKeywords||this.cp.$keywordsButton.hide(),this.cp.presentation.keywordListEnabled||this.cp.$keywordsWrapper.add(this.$keywordsButton).hide(),this.updateFooterKeyword(0),this.cp.$prevSlideButton=t("<div/>",{class:"h5p-footer-button h5p-footer-previous-slide","aria-label":this.cp.l10n.prevSlide,role:"button",tabindex:"-1","aria-disabled":"true"}).appendTo(i),new H5P.Tooltip(this.cp.$prevSlideButton.get(0),{position:"left"}),$i(this.cp.$prevSlideButton,(function(){return e.cp.previousSlide(void 0,!1)}));var a=t("<div/>",{class:"h5p-footer-slide-count"}).appendTo(i);this.cp.$footerCurrentSlide=t("<div/>",{html:"1",class:"h5p-footer-slide-count-current",title:this.cp.l10n.currentSlide,"aria-hidden":"true"}).appendTo(a),this.cp.$footerCounter=t("<div/>",{class:"hidden-but-read",html:this.cp.l10n.slideCount.replace("@index","1").replace("@total",this.cp.slides.length.toString())}).appendTo(i),t("<div/>",{html:"/",class:"h5p-footer-slide-count-delimiter","aria-hidden":"true"}).appendTo(a),this.cp.$footerMaxSlide=t("<div/>",{html:this.cp.slides.length,class:"h5p-footer-slide-count-max",title:this.cp.l10n.lastSlide,"aria-hidden":"true"}).appendTo(a),this.cp.$nextSlideButton=t("<div/>",{class:"h5p-footer-button h5p-footer-next-slide","aria-label":this.cp.l10n.nextSlide,role:"button",tabindex:"0"}).appendTo(i),H5P.Tooltip(this.cp.$nextSlideButton.get(0),{position:"right"}),$i(this.cp.$nextSlideButton,(function(){return e.cp.nextSlide(void 0,!1)})),void 0===this.cp.editor&&(this.cp.$exitSolutionModeButton=t("<div/>",{role:"button",class:"h5p-footer-exit-solution-mode","aria-label":this.cp.l10n.solutionModeTitle,tabindex:"0"}).appendTo(o),H5P.Tooltip(this.cp.$exitSolutionModeButton.get(0)),$i(this.cp.$exitSolutionModeButton,(function(){return n.cp.jumpToSlide(n.cp.slides.length-1)})),this.cp.enablePrintButton&&Ui.supported()&&(this.cp.$printButton=t("<div/>",{class:"h5p-footer-button h5p-footer-print","aria-label":this.cp.l10n.printTitle,role:"button",tabindex:"0"}).appendTo(o),H5P.Tooltip(this.cp.$printButton.get(0)),$i(this.cp.$printButton,(function(){return n.openPrintDialog()}))),H5P.fullscreenSupported&&(this.cp.$fullScreenButton=t("<div/>",{class:"h5p-footer-button h5p-footer-toggle-full-screen","aria-label":this.cp.l10n.fullscreen,role:"button",tabindex:"0"}),H5P.Tooltip(this.cp.$fullScreenButton.get(0),{position:"left"}),$i(this.cp.$fullScreenButton,(function(){return n.cp.toggleFullScreen()})),this.cp.$fullScreenButton.appendTo(o))),this.cp.$exitSolutionModeText=t("<div/>",{html:"",class:"h5p-footer-exit-solution-mode-text"}).appendTo(this.cp.$exitSolutionModeButton)},e.prototype.openPrintDialog=function(){var e=this,n=t(".h5p-wrapper");Ui.showDialog(this.cp.l10n,n,(function(t){Ui.print(e.cp,n,t)})).children('[role="dialog"]').focus()},e.prototype.updateProgressBar=function(t,e,n){var s,r=this;for(s=0;s<r.cp.progressbarParts.length;s+=1)t+1>s?r.cp.progressbarParts[s].addClass("h5p-progressbar-part-show"):r.cp.progressbarParts[s].removeClass("h5p-progressbar-part-show");r.progresbarKeyboardControls.setTabbableByIndex(t),r.cp.progressbarParts[t].addClass("h5p-progressbar-part-selected").attr("aria-selected",!0).siblings().removeClass("h5p-progressbar-part-selected").attr("aria-selected",!1),void 0!==e?!n&&r.cp.editor:r.cp.progressbarParts.forEach((function(t,e){r.setTaskAnswered(e,!1)}))},e.prototype.setTaskAnswered=function(t,e){this.cp.progressbarParts[t].find(".h5p-progressbar-part-has-task").toggleClass("h5p-answered",e),this.updateSlideTitle(t,{state:e?ho:lo})},e.prototype.updateSlideTitle=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.state;this.setSlideTitle(t,{state:Oi(n,this.getAnsweredState(t))})},e.prototype.setSlideTitle=function(t,e){var n=e.state,s=void 0===n?co:n,r=this.cp.progressbarParts[t].find(".h5p-progressbar-part-title"),i=this.answeredLabels[s].replace("@slideName",this.createSlideTitle(t));r.html("".concat(i))},e.prototype.getAnsweredState=function(t){var e=this.cp.progressbarParts[t],n=this.slideHasInteraction(t),s=this.cp.slideHasAnsweredTask(t);return n?e.find(".h5p-is-correct").length>0?uo:e.find(".h5p-is-wrong").length>0?po:s?ho:lo:co},e.prototype.slideHasInteraction=function(t){return this.cp.progressbarParts[t].find(".h5p-progressbar-part-has-task").length>0},e.prototype.updateFooter=function(t){this.cp.$footerCurrentSlide.html(t+1),this.cp.$footerMaxSlide.html(this.cp.slides.length),this.cp.$footerCounter.html(this.cp.l10n.slideCount.replace("@index",(t+1).toString()).replace("@total",this.cp.slides.length.toString())),this.cp.isSolutionMode&&t===this.cp.slides.length-1?this.cp.$footer.addClass("summary-slide"):this.cp.$footer.removeClass("summary-slide"),this.toggleNextAndPreviousButtonDisabled(t),this.updateFooterKeyword(t)},e.prototype.toggleNextAndPreviousButtonDisabled=function(t){var e=this.cp.slides.length-1;this.cp.$prevSlideButton.attr("aria-disabled",(0===t).toString()),this.cp.$nextSlideButton.attr("aria-disabled",(t===e).toString()),this.cp.$prevSlideButton.attr("tabindex",0===t?"-1":"0"),this.cp.$nextSlideButton.attr("tabindex",t===e?"-1":"0")},e.prototype.updateFooterKeyword=function(t){var e=this.cp.slides[t],n="";e&&e.keywords&&e.keywords[0]&&(n=e.keywords[0].main),!this.cp.isEditor()&&this.cp.showSummarySlide&&t>=this.cp.slides.length-1&&(n=this.cp.l10n.summary),this.cp.$keywordsButton.children(".current-slide-title").html(Oi(n,""))},e}(H5P.jQuery);const go=fo;var mo=function(t){var e=t.presentation;e=Ei.extend(!0,{globalBackgroundSelector:{fillGlobalBackground:"",imageGlobalBackground:{}},slides:[{slideBackgroundSelector:{fillSlideBackground:"",imageSlideBackground:{}}}]},e);var n,s=function(e,n,s){var r=t.$slidesWrapper.children().filter(":not(.h5p-summary-slide)");void 0!==s&&(r=r.eq(s)),e&&""!==e?r.addClass("has-background").css("background-image","").css("background-color",e):n&&n.path&&r.addClass("has-background").css("background-color","").css("background-image","url("+H5P.getPath(n.path,t.contentId)+")")};n=e.globalBackgroundSelector,s(n.fillGlobalBackground,n.imageGlobalBackground),e.slides.forEach((function(t,e){var n=t.slideBackgroundSelector;n&&s(n.fillSlideBackground,n.imageSlideBackground,e)}))},yo=function(t){return parseInt(t.dataset.index)},bo=function(){function t(t){var e=this,n=t.l10n,s=t.currentIndex;this.l10n=n,this.state={currentIndex:Oi(s,0)},this.eventDispatcher=new Ci,this.controls=new io([new oo]),this.controls.on("select",(function(t){e.onMenuItemSelect(yo(t.element))})),this.controls.on("close",(function(){return e.eventDispatcher.trigger("close")})),this.menuElement=this.createMenuElement(),this.currentSlideMarkerElement=this.createCurrentSlideMarkerElement()}var e=t.prototype;return e.init=function(t){var e=this;return this.menuItemElements=t.map((function(t){return e.createMenuItemElement(t)})),this.menuItemElements.forEach((function(t){return e.menuElement.appendChild(t)})),this.menuItemElements.forEach((function(t){return e.controls.addElement(t)})),this.setCurrentSlideIndex(this.state.currentIndex),this.menuItemElements},e.on=function(t,e){this.eventDispatcher.on(t,e)},e.getElement=function(){return this.menuElement},e.removeAllMenuItemElements=function(){var t=this;this.menuItemElements.forEach((function(e){t.controls.removeElement(e),t.menuElement.removeChild(e)})),this.menuItemElements=[]},e.createMenuElement=function(){var t=this.menuElement=document.createElement("ol");return t.setAttribute("role","menu"),t.classList.add("list-unstyled"),t},e.createMenuItemElement=function(t){var e=this,n=document.createElement("li");return n.setAttribute("role","menuitem"),n.addEventListener("click",(function(t){e.onMenuItemSelect(yo(t.currentTarget))})),this.applyConfigToMenuItemElement(n,t),n},e.applyConfigToMenuItemElement=function(t,e){t.innerHTML='<div class="h5p-keyword-subtitle">'.concat(e.subtitle,'</div><span class="h5p-keyword-title">').concat(e.title,"</span>"),t.dataset.index=e.index},e.onMenuItemSelect=function(t){this.setCurrentSlideIndex(t),this.eventDispatcher.trigger("select",{index:t})},e.setCurrentSlideIndex=function(t){var e=this.getElementByIndex(this.menuItemElements,t);e&&(this.state.currentIndex=t,this.updateCurrentlySelected(this.menuItemElements,this.state),this.controls.setTabbable(e))},e.updateCurrentlySelected=function(t,e){var n=this;t.forEach((function(t){var s=e.currentIndex===yo(t);t.classList.toggle("h5p-current",s),s&&t.appendChild(n.currentSlideMarkerElement)}))},e.scrollToKeywords=function(t){var e=this.getFirstElementAfter(t);if(e){var n=Ei(this.menuElement),s=n.scrollTop()+Ei(e).position().top-8;Ii?n.scrollTop(s):n.stop().animate({scrollTop:s},250)}},e.getFirstElementAfter=function(t){return this.menuItemElements.filter((function(e){return yo(e)>=t}))[0]},e.getElementByIndex=function(t,e){return t.filter((function(t){return yo(t)===e}))[0]},e.createCurrentSlideMarkerElement=function(){var t=document.createElement("div");return t.classList.add("hidden-but-read"),t.innerHTML=this.l10n.currentSlide,t},t}(),wo="specified",vo="next",So="previous",ko=function(){function t(t,e){var n=this,s=t.title,r=t.goToSlide,i=void 0===r?1:r,o=t.invisible,a=t.goToSlideType,c=void 0===a?wo:a,l=e.l10n,h=e.currentIndex;this.eventDispatcher=new Ci;var d="h5p-press-to-go",u=0;if(o)s=void 0,u=-1;else{if(!s)switch(c){case wo:s=l.goToSlide.replace(":num",i.toString());break;case vo:s=l.goToSlide.replace(":num",l.nextSlide);break;case So:s=l.goToSlide.replace(":num",l.prevSlide)}d+=" h5p-visible"}var p=i-1;c===vo?p=h+1:c===So&&(p=h-1),this.$element=Ei("<a/>",{href:"#",class:d,tabindex:u,title:s}),$i(this.$element,(function(t){n.eventDispatcher.trigger("navigate",p),t.preventDefault()}))}var e=t.prototype;return e.attach=function(t){t.html("").addClass("h5p-go-to-slide").append(this.$element)},e.on=function(t,e){this.eventDispatcher.on(t,e)},t}();const xo=function(t){var e=this;if(void 0===t.action)e.instance=new ko(t,{l10n:e.parent.parent.l10n,currentIndex:e.parent.index}),e.parent.parent.isEditor()||e.instance.on("navigate",(function(t){var n=t.data;e.parent.parent.jumpToSlide(n)}));else{var n;n=e.parent.parent.isEditor()?H5P.jQuery.extend(!0,{},t.action,e.parent.parent.elementsOverride):H5P.jQuery.extend(!0,t.action,e.parent.parent.elementsOverride);var s=e.parent.parent.elementInstances[e.parent.index]?e.parent.parent.elementInstances[e.parent.index].length:0;e.parent.parent.previousState&&e.parent.parent.previousState.answers&&e.parent.parent.previousState.answers[e.parent.index]&&e.parent.parent.previousState.answers[e.parent.index][s]&&(n.userDatas={state:e.parent.parent.previousState.answers[e.parent.index][s]}),n.params=n.params||{},e.instance=H5P.newRunnable(n,e.parent.parent.contentId,void 0,!0,{parent:e.parent.parent}),void 0!==e.instance.preventResize&&(e.instance.preventResize=!0)}void 0===e.parent.parent.elementInstances[e.parent.index]?e.parent.parent.elementInstances[e.parent.index]=[e.instance]:e.parent.parent.elementInstances[e.parent.index].push(e.instance),void 0!==e.instance.showCPComments||e.instance.isTask||void 0===e.instance.isTask&&void 0!==e.instance.showSolutions?(e.instance.coursePresentationIndexOnSlide=e.parent.parent.elementInstances[e.parent.index].length-1,void 0===e.parent.parent.slidesWithSolutions[e.parent.index]&&(e.parent.parent.slidesWithSolutions[e.parent.index]=[]),e.parent.parent.slidesWithSolutions[e.parent.index].push(e.instance)):t.solution&&(void 0===e.parent.parent.showCommentsAfterSolution[e.parent.index]&&(e.parent.parent.showCommentsAfterSolution[e.parent.index]=[]),e.parent.parent.showCommentsAfterSolution[e.parent.index].push(e.instance)),void 0!==e.instance.exportAnswers&&e.instance.exportAnswers&&(e.parent.parent.hasAnswerElements=!0),e.parent.parent.isTask||e.parent.parent.hideSummarySlide||(e.instance.isTask||void 0===e.instance.isTask&&void 0!==e.instance.showSolutions)&&(e.parent.parent.isTask=!0)};function Eo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function Co(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Eo(Object(n),!0).forEach((function(e){_o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Eo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function To(t){var e,n=this;s().call(n,xo,t.elements),n.getElement=function(){return e||(e=H5P.jQuery(To.createHTML(Co(Co({},t),{},{index:n.index})))),e},n.setCurrent=function(){this.parent.$current=e.addClass("h5p-current")},n.appendElements=function(){for(var s=0;s<n.children.length;s++)n.parent.attachElement(t.elements[s],n.children[s].instance,e,n.index);n.parent.elementsAttached[n.index]=!0,n.parent.trigger("domChanged",{$target:e,library:"CoursePresentation",key:"newSlide"},{bubbles:!0,external:!0})}}To.createHTML=function(t){return'<div role="tabpanel" id="slide-'+t.index+'" aria-labelledby="progressbar-part-'+t.index+'" class="h5p-slide"> <div role="document" tabindex="0" '+(void 0!==t.background?' style="background:'+t.background+'"':"")+"></div></div>"};const Ao=To;const Io=function(t,e){var n=new H5P.ConfirmationDialog(t).appendTo(document.body);return n.getElement().classList.add("h5p-cp-confirmation-dialog"),n.show(),n};function Po(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var s,r,i=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(i.push(s.value),!e||i.length!==e);o=!0);}catch(t){a=!0,r=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Do(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Do(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Do(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function Oo(t){return Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oo(t)}var Lo=function(t,e,n){var r=this;var i=this;this.data=[],this.doc=new Ce,this.presentation=t.presentation,this.slides=this.presentation.slides,this.contentId=e,this.elementInstances=[],this.elementsAttached=[],this.slidesWithSolutions=[],this.showCommentsAfterSolution=[],this.hasAnswerElements=!1,this.ignoreResize=!1,this.isTask=!1,this.standalone=!0,this.isReportingEnabled=!1,this.popups={},n.cpEditor&&(this.editor=n.cpEditor),this.editor?this.provider=new xi("ws://192.168.1.3:1234",function(t,e){return Math.floor(Math.random()*(e-t)+t)}(1,10).toString(),this.doc,{autoConnect:!0}):this.provider=new xi("ws://192.168.1.3:1234",e,this.doc,{autoConnect:!0});var o=this.doc.getMap("pageState");o.observe((function(t,e){r.processJumpToSlide(o.get("currentPage"))})),n&&(this.previousState=n.previousState,this.standalone=n.standalone,this.isReportingEnabled=n.isReportingEnabled||n.isScoringEnabled),this.currentSlideIndex=this.previousState&&this.previousState.progress?this.previousState.progress:0,this.presentation.keywordListEnabled=void 0===t.presentation.keywordListEnabled||t.presentation.keywordListEnabled,this.l10n=Ei.extend({slide:"Slide",score:"Score",yourScore:"Your score",maxScore:"Max score",total:"Total",totalScore:"Total Score",showSolutions:"Show solutions",summary:"summary",retry:"Retry",exportAnswers:"Export text",close:"Close",hideKeywords:"Hide sidebar navigation menu",showKeywords:"Show sidebar navigation menu",fullscreen:"Fullscreen",exitFullscreen:"Exit fullscreen",prevSlide:"Previous slide",nextSlide:"Next slide",currentSlide:"Current slide",lastSlide:"Last slide",solutionModeTitle:"Exit solution mode",solutionModeText:"Solution Mode",summaryMultipleTaskText:"Multiple tasks",scoreMessage:"You achieved:",shareFacebook:"Share on Facebook",shareTwitter:"Share on Twitter",shareGoogle:"Share on Google+",goToSlide:"Go to slide :num",solutionsButtonTitle:"Show comments",printTitle:"Print",printIngress:"How would you like to print this presentation?",printAllSlides:"Print all slides",printCurrentSlide:"Print current slide",noTitle:"No title",accessibilitySlideNavigationExplanation:"Use left and right arrow to change slide in that direction whenever canvas is selected.",accessibilityProgressBarLabel:"Choose slide to display",containsNotCompleted:"@slideName contains not completed interaction",containsCompleted:"@slideName contains completed interaction",slideCount:"Slide @index of @total",accessibilityCanvasLabel:"Presentation canvas. Use left and right arrow to move between slides.",containsOnlyCorrect:"@slideName only has correct answers",containsIncorrectAnswers:"@slideName has incorrect answers",shareResult:"Share Result",accessibilityTotalScore:"You got @score of @maxScore points in total",accessibilityEnteredFullscreen:"Entered fullscreen",accessibilityExitedFullscreen:"Exited fullscreen",confirmDialogHeader:"Submit your answers",confirmDialogText:"This will submit your results, do you want to continue?",confirmDialogConfirmText:"Submit and see results",slideshowNavigationLabel:"Slideshow navigation"},void 0!==t.l10n?t.l10n:{}),t.override&&(this.activeSurface=!!t.override.activeSurface,this.hideSummarySlide=!!t.override.hideSummarySlide,this.enablePrintButton=!!t.override.enablePrintButton,this.showSummarySlideSolutionButton=void 0===t.override.summarySlideSolutionButton||t.override.summarySlideSolutionButton,this.showSummarySlideRetryButton=void 0===t.override.summarySlideRetryButton||t.override.summarySlideRetryButton,t.override.social&&(this.enableTwitterShare=!!t.override.social.showTwitterShare,this.enableFacebookShare=!!t.override.social.showFacebookShare,this.enableGoogleShare=!!t.override.social.showGoogleShare,this.twitterShareStatement=t.override.social.twitterShare.statement,this.twitterShareHashtags=t.override.social.twitterShare.hashtags,this.twitterShareUrl=t.override.social.twitterShare.url,this.facebookShareUrl=t.override.social.facebookShare.url,this.facebookShareQuote=t.override.social.facebookShare.quote,this.googleShareUrl=t.override.social.googleShareUrl)),this.keywordMenu=new bo({l10n:this.l10n,currentIndex:void 0!==this.previousState?this.previousState.progress:0}),this.setElementsOverride(t.override),s().call(this,Ao,t.presentation.slides),this.on("resize",this.resize,this),this.on("printing",(function(t){i.ignoreResize=!t.data.finished,t.data.finished?i.resize():t.data.allSlides&&i.attachAllElements()}))};(Lo.prototype=Object.create(s().prototype)).constructor=Lo,Lo.prototype.getCurrentState=function(){var t=this,e=this.previousState?this.previousState:{};e.progress=this.getCurrentSlideIndex(),e.answers||(e.answers=[]),e.answered=this.elementInstances.map((function(e,n){return t.slideHasAnsweredTask(n)}));for(var n=0;n<this.elementInstances.length;n++)if(this.elementInstances[n])for(var s=0;s<this.elementInstances[n].length;s++){var r=this.elementInstances[n][s];(r.getCurrentState instanceof Function||"function"==typeof r.getCurrentState)&&(e.answers[n]||(e.answers[n]=[]),e.answers[n][s]=r.getCurrentState())}return e},Lo.prototype.slideHasAnsweredTask=function(t){return(this.slidesWithSolutions[t]||[]).filter((function(t){return Ai(t.getAnswerGiven)})).some((function(t){return t.getAnswerGiven()}))},Lo.prototype.attach=function(t){var e=this,n=this;void 0!==this.isRoot&&this.isRoot()&&this.setActivityStarted();var s='<div class="h5p-keymap-explanation hidden-but-read">'+this.l10n.accessibilitySlideNavigationExplanation+'</div><div class="h5p-fullscreen-announcer hidden-but-read" aria-live="polite"></div><div class="h5p-wrapper" tabindex="0" role="region" aria-roledescription="carousel" aria-label="'+this.l10n.accessibilityCanvasLabel+'">  <div class="h5p-current-slide-announcer hidden-but-read" aria-live="polite"></div>  <div tabindex="-1"></div>  <div class="h5p-box-and-nav-wrapper">    <nav class="h5p-cp-navigation" aria-label="'+this.l10n.slideshowNavigationLabel+'">      <div class="h5p-progressbar" role="tablist" aria-label="'+this.l10n.accessibilityProgressBarLabel+'"></div>    </nav>    <div class="h5p-box-wrapper">      <div class="h5p-presentation-wrapper">        <div class="h5p-keywords-wrapper"></div>        <div class="h5p-slides-wrapper"></div>      </div>    </div>  </div>  <div class="h5p-footer"></div></div>';t.attr("role","application").addClass("h5p-course-presentation").html(s),this.$container=t,this.$slideAnnouncer=t.find(".h5p-current-slide-announcer"),this.$fullscreenAnnouncer=t.find(".h5p-fullscreen-announcer"),this.$slideTop=this.$slideAnnouncer.next(),this.$wrapper=t.children(".h5p-wrapper"),this.activeSurface&&this.$wrapper.addClass("h5p-course-presentation-active-surface"),this.$wrapper.focus((function(){n.initKeyEvents()})).blur((function(){void 0!==n.keydown&&(H5P.jQuery("body").unbind("keydown",n.keydown),delete n.keydown)})).click((function(t){var e=H5P.jQuery(t.target),s=n.belongsToTagName(t.target,["input","textarea","a","button"],t.currentTarget),r=-1!==t.target.tabIndex,i=e.closest(".h5p-popup-container"),o=0!==i.length;if(!s&&!r&&!n.editor)if(o){var a=e.closest("[tabindex]");1===a.closest(".h5p-popup-container").length?a.focus():i.find(".h5p-close-popup").focus()}else n.$wrapper.focus();n.presentation.keywordListEnabled&&!n.presentation.keywordListAlwaysShow&&n.presentation.keywordListAutoHide&&!e.is("textarea, .h5p-icon-pencil, span")&&n.hideKeywords()})),this.on("exitFullScreen",(function(){e.$footer.removeClass("footer-full-screen"),e.$fullScreenButton.attr("aria-label",e.l10n.fullscreen),e.$fullscreenAnnouncer.html(e.l10n.accessibilityExitedFullscreen)})),this.on("enterFullScreen",(function(){e.$fullscreenAnnouncer.html(e.l10n.accessibilityEnteredFullscreen)}));var r=parseInt(this.$wrapper.css("width"));this.width=0!==r?r:640;var i=parseInt(this.$wrapper.css("height"));this.height=0!==i?i:400,this.ratio=16/9,this.fontSize=16,this.$boxWrapper=this.$wrapper.find(".h5p-box-wrapper");var o,a=this.$boxWrapper.children(".h5p-presentation-wrapper");if(this.$slidesWrapper=a.children(".h5p-slides-wrapper"),this.$keywordsWrapper=a.children(".h5p-keywords-wrapper"),this.$progressbar=this.$wrapper.find(".h5p-progressbar"),this.$footer=this.$wrapper.children(".h5p-footer"),this.initKeywords=void 0===this.presentation.keywordListEnabled||!0===this.presentation.keywordListEnabled||void 0!==this.editor,this.activeSurface&&void 0===this.editor&&(this.initKeywords=!1,this.$boxWrapper.css("height","100%")),this.isSolutionMode=!1,this.createSlides(),this.elementsAttached[this.currentSlideIndex]=!0,this.showSummarySlide=!1,this.hideSummarySlide?this.showSummarySlide=!this.hideSummarySlide:this.slidesWithSolutions.forEach((function(t){n.showSummarySlide=t.length})),void 0===this.editor&&(this.showSummarySlide||this.hasAnswerElements)){var c={elements:[],keywords:[]};this.slides.push(c),(o=H5P.jQuery(Ao.createHTML(c)).appendTo(this.$slidesWrapper)).addClass("h5p-summary-slide"),this.isCurrentSlide(this.slides.length-1)&&(this.$current=o)}var l=this.getKeywordMenuConfig();l.length>0||this.isEditor()?(this.keywordMenu.init(l),this.keywordMenu.on("select",(function(t){return e.keywordClick(t.data.index)})),this.keywordMenu.on("close",(function(){return e.hideKeywords()})),this.keywordMenu.on("select",(function(){e.$currentKeyword=e.$keywords.children(".h5p-current")})),this.$keywords=Ei(this.keywordMenu.getElement()).appendTo(this.$keywordsWrapper),this.$currentKeyword=this.$keywords.children(".h5p-current"),void 0!==this.presentation.keywordListOpacity&&this.setKeywordsOpacity(this.presentation.keywordListOpacity),this.presentation.keywordListAlwaysShow&&this.showKeywords()):(this.$keywordsWrapper.remove(),this.initKeywords=!1),void 0===this.editor&&this.activeSurface?(this.$progressbar.add(this.$footer).remove(),H5P.fullscreenSupported&&(this.$fullScreenButton=H5P.jQuery("<div/>",{class:"h5p-toggle-full-screen","aria-label":this.l10n.fullscreen,role:"button",tabindex:0,appendTo:this.$wrapper}),H5P.Tooltip(this.$fullScreenButton.get(0),{position:"left"}),$i(this.$fullScreenButton,(function(){return n.toggleFullScreen()})))):(this.initTouchEvents(),this.navigationLine=new go(this),this.previousState&&this.previousState.progress||this.setSlideNumberAnnouncer(0,!1),this.summarySlideObject=new ji(this,o)),new mo(this),this.previousState&&this.previousState.progress&&this.jumpToSlide(this.previousState.progress,!1,null,!1,!0);var h=this.doc.getMap("pageState");h.has("currentPage")&&this.jumpToSlide(h.get("currentPage"))},Lo.prototype.belongsToTagName=function(t,e,n){if(!t)return!1;n=n||document.body,"string"==typeof e&&(e=[e]),e=e.map((function(t){return t.toLowerCase()}));var s=t.tagName.toLowerCase();return-1!==e.indexOf(s)||n!==t&&this.belongsToTagName(t.parentNode,e,n)},Lo.prototype.updateKeywordMenuFromSlides=function(){this.keywordMenu.removeAllMenuItemElements();var t=this.getKeywordMenuConfig();return Ei(this.keywordMenu.init(t))},Lo.prototype.getKeywordMenuConfig=function(){var t=this;return this.slides.map((function(e,n){return{title:t.createSlideTitle(e),subtitle:"".concat(t.l10n.slide," ").concat(n+1),index:n}})).filter((function(t){return null!==t.title}))},Lo.prototype.createSlideTitle=function(t){var e=this.isEditor()?this.l10n.noTitle:null;return this.hasKeywords(t)?t.keywords[0].main:e},Lo.prototype.isEditor=function(){return void 0!==this.editor},Lo.prototype.hasKeywords=function(t){return void 0!==t.keywords&&t.keywords.length>0},Lo.prototype.createSlides=function(){for(var t=this,e=0;e<t.children.length;e++){var n=e===t.currentSlideIndex;t.children[e].getElement().appendTo(t.$slidesWrapper),n&&t.children[e].setCurrent(),(t.isEditor()||0===e||1===e||n)&&t.children[e].appendElements()}},Lo.prototype.hasScoreData=function(t){return"undefined"!==Oo(t)&&"function"==typeof t.getScore&&"function"==typeof t.getMaxScore},Lo.prototype.getScore=function(){var t=this;return Ti(t.slidesWithSolutions).reduce((function(e,n){return e+(t.hasScoreData(n)?n.getScore():0)}),0)},Lo.prototype.getMaxScore=function(){var t=this;return Ti(t.slidesWithSolutions).reduce((function(e,n){return e+(t.hasScoreData(n)?n.getMaxScore():0)}),0)},Lo.prototype.setProgressBarFeedback=function(t){var e=this;void 0!==t&&t?t.forEach((function(t){var n=e.progressbarParts[t.slide-1].find(".h5p-progressbar-part-has-task");if(n.hasClass("h5p-answered")){var s=t.score>=t.maxScore;n.addClass(s?"h5p-is-correct":"h5p-is-wrong"),e.navigationLine.updateSlideTitle(t.slide-1)}})):this.progressbarParts.forEach((function(t){t.find(".h5p-progressbar-part-has-task").removeClass("h5p-is-correct").removeClass("h5p-is-wrong")}))},Lo.prototype.toggleKeywords=function(){this[this.$keywordsWrapper.hasClass("h5p-open")?"hideKeywords":"showKeywords"]()},Lo.prototype.hideKeywords=function(){this.$keywordsWrapper.hasClass("h5p-open")&&(void 0!==this.$keywordsButton&&(this.$keywordsButton.attr("aria-label",this.l10n.showKeywords),this.$keywordsButton.attr("aria-expanded","false"),this.$keywordsButton.focus()),this.$keywordsWrapper.removeClass("h5p-open"))},Lo.prototype.showKeywords=function(){this.$keywordsWrapper.hasClass("h5p-open")||(void 0!==this.$keywordsButton&&(this.$keywordsButton.attr("aria-label",this.l10n.hideKeywords),this.$keywordsButton.attr("aria-expanded","true")),this.$keywordsWrapper.addClass("h5p-open"),this.presentation.keywordListAlwaysShow||this.$keywordsWrapper.find('li[tabindex="0"]').focus())},Lo.prototype.setKeywordsOpacity=function(t){if(""!==this.$keywordsWrapper.css("background-color")){var e=Po(this.$keywordsWrapper.css("background-color").match(/\d+/g),3),n=e[0],s=e[1],r=e[2];this.$keywordsWrapper.css("background-color","rgba(".concat(n,", ").concat(s,", ").concat(r,", ").concat(t/100,")"))}},Lo.prototype.fitCT=function(){void 0===this.editor&&this.$current.find(".h5p-ct").each((function(){for(var t=100,e=H5P.jQuery(this),n=e.parent().height();e.outerHeight()>n&&(t--,e.css({fontSize:t+"%",lineHeight:t+65+"%"}),!(t<0)););}))},Lo.prototype.resize=function(){var t=this.$container.hasClass("h5p-fullscreen")||this.$container.hasClass("h5p-semi-fullscreen");if(!this.ignoreResize){this.$wrapper.css("width","auto");var e=this.$container.width(),n={};if(t){var s=this.$container.height();e/s>this.ratio&&(e=s*this.ratio,n.width=e+"px")}var r=e/this.width;n.height=e/this.ratio+"px",n.fontSize=this.fontSize*r+"px",void 0!==this.editor&&this.editor.setContainerEm(this.fontSize*r*.75),this.$wrapper.css(n),this.swipeThreshold=100*r;var i=this.elementInstances[this.$current.index()];if(void 0!==i)for(var o=this.slides[this.$current.index()].elements,a=0;a<i.length;a++){var c=i[a];void 0!==c.preventResize&&!1!==c.preventResize||void 0===c.$||o[a].displayAsButton||H5P.trigger(c,"resize")}this.fitCT()}},Lo.prototype.toggleFullScreen=function(){H5P.isFullscreen||this.$container.hasClass("h5p-fullscreen")||this.$container.hasClass("h5p-semi-fullscreen")?void 0!==H5P.exitFullScreen&&void 0!==H5P.fullScreenBrowserPrefix?H5P.exitFullScreen():void 0===H5P.fullScreenBrowserPrefix?H5P.jQuery(".h5p-disable-fullscreen").click():""===H5P.fullScreenBrowserPrefix?window.top.document.exitFullScreen():"ms"===H5P.fullScreenBrowserPrefix?window.top.document.msExitFullscreen():window.top.document[H5P.fullScreenBrowserPrefix+"CancelFullScreen"]():(this.$footer.addClass("footer-full-screen"),this.$fullScreenButton.attr("aria-label",this.l10n.exitFullscreen),H5P.fullScreen(this.$container,this),void 0===H5P.fullScreenBrowserPrefix&&H5P.jQuery(".h5p-disable-fullscreen").hide())},Lo.prototype.focus=function(){this.$wrapper.focus()},Lo.prototype.keywordClick=function(t){this.shouldHideKeywordsAfterSelect()&&this.hideKeywords(),this.jumpToSlide(t,!0)},Lo.prototype.shouldHideKeywordsAfterSelect=function(){return this.presentation.keywordListEnabled&&!this.presentation.keywordListAlwaysShow&&this.presentation.keywordListAutoHide&&void 0===this.editor},Lo.prototype.setElementsOverride=function(t){this.elementsOverride={params:{}},t&&(this.elementsOverride.params.behaviour={},t.showSolutionButton&&(this.elementsOverride.params.behaviour.enableSolutionsButton="on"===t.showSolutionButton),t.retryButton&&(this.elementsOverride.params.behaviour.enableRetry="on"===t.retryButton))},Lo.prototype.attachElements=function(t,e){if(void 0===this.elementsAttached[e]){var n=this.slides[e],s=this.elementInstances[e];if(void 0!==n.elements)for(var r=0;r<n.elements.length;r++)this.attachElement(n.elements[r],s[r],t,e);this.trigger("domChanged",{$target:t,library:"CoursePresentation",key:"newSlide"},{bubbles:!0,external:!0}),this.elementsAttached[e]=!0}},Lo.prototype.attachElement=function(t,e,n,s){var r=void 0!==t.displayAsButton&&t.displayAsButton,i=void 0!==t.buttonSize?"h5p-element-button-"+t.buttonSize:"",o="h5p-element"+(r?" h5p-element-button-wrapper":"")+(i.length?" "+i:""),a=H5P.jQuery("<div>",{class:o}).css({left:t.x+"%",top:t.y+"%",width:t.width+"%",height:t.height+"%"}).appendTo(n.children('[role="document"]').first()),c=void 0===t.backgroundOpacity||0===t.backgroundOpacity;if(a.toggleClass("h5p-transparent",c),r){this.createInteractionButton(t,e).appendTo(a)}else{var l=t.action&&t.action.library?this.getLibraryTypePmz(t.action.library):"other",h=H5P.jQuery("<div>",{class:"h5p-element-outer ".concat(l,"-outer-element")}).css({background:"rgba(255,255,255,"+(void 0===t.backgroundOpacity?0:t.backgroundOpacity/100)+")"}).appendTo(a),d=H5P.jQuery("<div>",{class:"h5p-element-inner"}).appendTo(h);if(e.on("set-size",(function(t){for(var e in t.data)a.get(0).style[e]=t.data[e]})),e.attach(d),void 0!==t.action&&"H5P.InteractiveVideo"===t.action.library.substr(0,20)){var u=function(){e.$container.addClass("h5p-fullscreen"),e.controls.$fullscreen&&e.controls.$fullscreen.remove(),e.hasFullScreen=!0,e.controls.$play.hasClass("h5p-pause")?e.$controls.addClass("h5p-autohide"):e.enableAutoHide()};void 0!==e.controls?u():e.on("controls",u)}this.setOverflowTabIndex()}return void 0!==this.editor?this.editor.processElement(t,a,s,e):(t.solution&&this.addElementSolutionButton(t,e,a),this.hasAnswerElements=this.hasAnswerElements||void 0!==e.exportAnswers),a},Lo.prototype.disableTabIndexes=function(){var t=this.$container.find(".h5p-popup-container");this.$tabbables=this.$container.find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter((function(){var e=Ei(this),n=Ei.contains(t.get(0),e.get(0));if(e.data("tabindex"))return!0;if(!n){var s=e.attr("tabindex");return e.data("tabindex",s),e.attr("tabindex","-1"),!0}return!1}))},Lo.prototype.restoreTabIndexes=function(){this.$tabbables&&this.$tabbables.each((function(){var t=Ei(this),e=t.data("tabindex");t.hasClass("ui-slider-handle")?(t.attr("tabindex",0),t.removeData("tabindex")):void 0!==e?(t.attr("tabindex",e),t.removeData("tabindex")):t.removeAttr("tabindex")}))},Lo.prototype.createInteractionButton=function(t,e){var n=this,s=t.action.metadata?t.action.metadata.title:"";""===s&&(s=t.action.params&&t.action.params.contentName||t.action.library.split(" ")[0].split(".")[1]);var r=this.getLibraryTypePmz(t.action.library),i=Ei("<div>",{role:"button",tabindex:0,"aria-label":s,"aria-popup":!0,"aria-expanded":!1,class:"h5p-element-button h5p-element-button-".concat(t.buttonSize," ").concat(r,"-button")}),o=Ei('<div class="h5p-button-element"></div>');e.attach(o);var a="h5p-advancedtext"===r?{x:t.x,y:t.y}:null;return $i(i,(function(){var t;i.attr("aria-expanded","true"),n.showInteractionPopup(e,i,o,r,(t=i,function(){return t.attr("aria-expanded","false")}),a)})),void 0!==t.action&&"H5P.InteractiveVideo"===t.action.library.substr(0,20)&&e.on("controls",(function(){e.controls.$fullscreen&&e.controls.$fullscreen.remove()})),i},Lo.prototype.showInteractionPopup=function(t,e,n,s,r){var i=this,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=function(){t.trigger("resize")};this.isEditor()||(this.on("exitFullScreen",a),this.showPopup({popupContent:n,$focusOnClose:e,parentPosition:o,remove:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||n.detach(),i.off("exitFullScreen",a),r()},classes:s,instance:t,keepInDOM:"h5p-interactivevideo"===s}),H5P.trigger(t,"resize"),"h5p-image"===s&&this.resizePopupImage(n),setTimeout((function(){var t=n.find(":input").add(n.find("[tabindex]"));t.length?t[0].focus():(n.attr("tabindex",0),n.focus())}),200),Ai(t.setActivityStarted)&&Ai(t.getScore)&&t.setActivityStarted())},Lo.prototype.getLibraryTypePmz=function(t){return(e=t.split(" ")[0],e.replace(/[\W]/g,"-")).toLowerCase();var e},Lo.prototype.resizePopupImage=function(t){var e=Number(t.css("fontSize").replace("px","")),n=t.find("img"),s=function(n,s){if(!(s/e<18.5)){var r=n/s;s=18.5*e,t.css({width:s*r,height:s})}};n.height()?s(n.width(),n.height()):n.one("load",(function(){s(this.width,this.height)}))},Lo.prototype.addElementSolutionButton=function(t,e,n){var s=this;e.showCPComments=function(){if(0===n.children(".h5p-element-solution").length&&(i=t.solution,Ni.html(i).text().trim()).length>0){var e=Ei("<div/>",{role:"button",tabindex:0,title:s.l10n.solutionsButtonTitle,"aria-haspopup":"dialog","aria-expanded":!1,class:"h5p-element-solution"}).append('<span class="joubel-icon-comment-normal"><span class="h5p-icon-shadow"></span><span class="h5p-icon-speech-bubble"></span><span class="h5p-icon-question"></span></span>').appendTo(n),r={x:t.x,y:t.y};t.displayAsButton||(r.x+=t.width-4,r.y+=t.height-12),$i(e,(function(n){s.showPopup({popupContent:t.solution,$focusOnClose:e,parentPosition:r,updateAriaExpanded:!0}),e.attr("aria-expanded",!0),n.stopPropagation()}))}var i},void 0!==t.alwaysDisplayComments&&t.alwaysDisplayComments&&e.showCPComments()},Lo.prototype.showPopup=function(t){var e,n=this,s=t.popupContent,r=t.$focusOnClose,i=t.parentPosition,o=void 0===i?null:i,a=t.remove,c=t.classes,l=void 0===c?"h5p-popup-comment-field":c,h=t.instance,d=t.keepInDOM,u=void 0!==d&&d,p=t.updateAriaExpanded,f=this;this.popupId=void 0===this.popupId?0:this.popupId+1;var g,m=function(t){e?e=!1:(f.restoreTabIndexes(),r.focus(),p&&r.attr("aria-expanded",!1),void 0!==a&&setTimeout((function(){a(u)}),100),t.preventDefault(),g.addClass("h5p-animate"),g.find(".h5p-popup-container").addClass("h5p-animate"),setTimeout((function(){u?g.hide():g.remove()}),100))};if(u&&h&&f.popups[h.subContentId]&&(g=f.popups[h.subContentId]),void 0===g){var y=(g=Ei('<div class="h5p-popup-overlay '+l+'"><div class="h5p-popup-container" role="dialog"aria-modal="true" aria-live="true" aria-labelledby="popup-title-'+this.popupId+'"> <div role="button" tabindex="0" class="h5p-close-popup" title="'+this.l10n.close+'"></div><div class="h5p-popup-wrapper" role="document"></div></div></div>')).find(".h5p-popup-wrapper");s instanceof H5P.jQuery?y.append(s):y.html(s);var b="";y.children().each((function(t,e){e.setAttribute("id","popup-content-"+n.popupId+"-"+t),b+="popup-content-"+n.popupId+"-"+t+" "})),g.find(".h5p-popup-container").attr("aria-describedby",b),h&&h.subContentId&&(f.popups[h.subContentId]=g)}var w=g.find(".h5p-popup-container");return function(t,e,s){if(s){e.css({visibility:"hidden"}),t.prependTo(n.$wrapper);var r=e.height(),i=e.width(),o=t.height(),a=i*(100/t.width()),c=r*(100/o);if(a>50&&c>50)t.detach();else{a>c&&c<45&&(a=Math.sqrt(a*c),e.css({width:a+"%"}));a>90?a=90:a<22&&(a=22);var l=100-a-5,h=s.x;s.x>l?h=l:s.x<5&&(h=5);var d=100-(c=e.height()*(100/o))-10,u=s.y;s.y>d?u=d:s.y<10&&(u=10),t.detach(),e.css({left:h+"%",top:u+"%"})}}}(g,w,o),g.addClass("h5p-animate"),w.css({visibility:""}).addClass("h5p-animate"),0===g.parent().length?g.prependTo(this.$wrapper):g.show(),g.removeClass("h5p-animate").click(m).find(".h5p-popup-container").removeClass("h5p-animate").click((function(){e=!0})).keydown((function(t){t.which===Mi&&m(t)})).find(".h5p-close-popup").focus(),this.disableTabIndexes(),$i(g.find(".h5p-close-popup"),(function(t){return m(t)})),g},Lo.prototype.checkForSolutions=function(t){return void 0!==t.showSolutions||void 0!==t.showCPComments},Lo.prototype.initKeyEvents=function(){if(void 0===this.keydown&&!this.activeSurface){var t=this,e=!1;this.keydown=function(n){e||((37!==n.keyCode&&33!==n.keyCode||!t.previousSlide(void 0,!1))&&(39!==n.keyCode&&34!==n.keyCode||!t.nextSlide(void 0,!1))||(n.preventDefault(),e=!0),e&&setTimeout((function(){e=!1}),300))},H5P.jQuery("body").keydown(this.keydown)}},Lo.prototype.initTouchEvents=function(){var t,e,n,s,r,i,o=this,a=!1,c=!1,l=function(t){return{"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,transform:t}},h=l("");this.$slidesWrapper.bind("touchstart",(function(l){c=!1,n=t=l.originalEvent.touches[0].pageX,e=l.originalEvent.touches[0].pageY;var h=o.$slidesWrapper.width();s=0===o.currentSlideIndex?0:-h,r=o.currentSlideIndex+1>=o.slides.length?0:h,i=null,a=!0})).bind("touchmove",(function(h){var d=h.originalEvent.touches;a&&(o.$current.prev().addClass("h5p-touch-move"),o.$current.next().addClass("h5p-touch-move"),a=!1),n=d[0].pageX;var u=t-n;null===i&&(i=Math.abs(e-h.originalEvent.touches[0].pageY)>Math.abs(u)),1!==d.length||i||(h.preventDefault(),c||(u<0?o.$current.prev().css(l("translateX("+(s-u)+"px")):o.$current.next().css(l("translateX("+(r-u)+"px)")),o.$current.css(l("translateX("+-u+"px)"))))})).bind("touchend",(function(){if(!i){var e=t-n;if(e>o.swipeThreshold&&o.nextSlide(void 0,!1)||e<-o.swipeThreshold&&o.previousSlide(void 0,!1))return}o.$slidesWrapper.children().css(h).removeClass("h5p-touch-move")}))},Lo.prototype.updateTouchPopup=function(t,e,n,s){if(arguments.length<=0)void 0!==this.touchPopup&&this.touchPopup.remove();else{var r="",i=.15;if(void 0!==this.$keywords&&void 0!==this.$keywords.children(":eq("+e+")").find("span").html())r+=this.$keywords.children(":eq("+e+")").find("span").html();else{var o=e+1;r+=this.l10n.slide+" "+o}void 0===this.editor&&e>=this.slides.length-1&&(r=this.l10n.showSolutions),void 0===this.touchPopup?this.touchPopup=H5P.jQuery("<div/>",{class:"h5p-touch-popup"}).insertAfter(t):this.touchPopup.insertAfter(t),s-t.parent().height()*i<0?s=0:s-=t.parent().height()*i,this.touchPopup.css({"max-width":t.width()-n,left:n,top:s}),this.touchPopup.html(r)}},Lo.prototype.previousSlide=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.$current.prev();if(!n.length)return!1;if(e){var s=this.doc.getMap("pageState");return s.set("currentPage",n.index()),this.processJumpToSlide(n.index(),t,!1)}return this.jumpToSlide(n.index(),t,null,!1)},Lo.prototype.nextSlide=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.$current.next();if(!n.length)return!1;if(e){var s=this.doc.getMap("pageState");return s.set("currentPage",n.index()),this.processJumpToSlide(n.index(),t,!1)}return this.jumpToSlide(n.index(),t,null,!1)},Lo.prototype.isCurrentSlide=function(t){return this.currentSlideIndex===t},Lo.prototype.getCurrentSlideIndex=function(){return this.currentSlideIndex},Lo.prototype.attachAllElements=function(){for(var t=this.$slidesWrapper.children(),e=0;e<this.slides.length;e++)this.attachElements(t.eq(e),e);void 0!==this.summarySlideObject&&this.summarySlideObject.updateSummarySlide(this.slides.length-1,!0)},Lo.prototype.processJumpToSlide=function(t,e,n){var s=this;if(void 0===this.editor&&this.contentId){var r=this.createXAPIEventTemplate("progressed");r.data.statement.object.definition.extensions["http://id.tincanapi.com/extension/ending-point"]=t+1,this.trigger(r)}if(!this.$current.hasClass("h5p-animate")){var i=this.$current.addClass("h5p-animate"),o=s.$slidesWrapper.children(),a=o.filter(":lt("+t+")");this.$current=o.eq(t).addClass("h5p-animate");var c=this.currentSlideIndex;this.currentSlideIndex=t,this.attachElements(this.$current,t);var l=this.$current.next();return l.length&&this.attachElements(l,t+1),this.setOverflowTabIndex(),setTimeout((function(){i.removeClass("h5p-current"),o.css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"",transform:""}).removeClass("h5p-touch-move").removeClass("h5p-previous"),a.addClass("h5p-previous"),s.$current.addClass("h5p-current"),s.trigger("changedSlide",s.$current.index())}),1),setTimeout((function(){if(s.$slidesWrapper.children().removeClass("h5p-animate"),void 0===s.editor){var t=s.elementInstances[s.currentSlideIndex],e=s.slides[s.currentSlideIndex].elements;if(void 0!==t)for(var n=0;n<t.length;n++)e[n].displayAsButton||"function"!=typeof t[n].setActivityStarted||"function"!=typeof t[n].getScore||t[n].setActivityStarted()}}),250),void 0!==this.$keywords&&(this.keywordMenu.setCurrentSlideIndex(t),this.$currentKeyword=this.$keywords.find(".h5p-current"),e||this.keywordMenu.scrollToKeywords(t)),s.presentation.keywordListEnabled&&s.presentation.keywordListAlwaysShow&&s.showKeywords(),s.navigationLine&&(s.navigationLine.updateProgressBar(t,c,this.isSolutionMode),s.navigationLine.updateFooter(t),this.setSlideNumberAnnouncer(t,n)),s.summarySlideObject&&s.summarySlideObject.updateSummarySlide(t,!0),void 0!==this.editor&&void 0!==this.editor.dnb&&(this.editor.dnb.setContainer(this.$current),this.editor.dnb.blurAll()),this.trigger("resize"),this.fitCT(),!0}},Lo.prototype.jumpToSlide=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.standalone&&this.showSummarySlide&&t===this.slides.length-1&&!this.isSolutionMode&&this.isReportingEnabled&&!i){if(this.currentSlideIndex===this.slides.length-1)return!1;var o=Io({headerText:this.l10n.confirmDialogHeader,dialogText:this.l10n.confirmDialogText,confirmText:this.l10n.confirmDialogConfirmationText});o.on("canceled",(function(){return!1})),o.on("confirmed",(function(){e.doc.getMap("pageState").set("currentPage",t),e.processJumpToSlide(t,n,r),s&&s()}))}else{var a=this.doc.getMap("pageState");a.set("currentPage",t),this.processJumpToSlide(t,n,r),s&&s()}},Lo.prototype.setOverflowTabIndex=function(){void 0!==this.$current&&this.$current.find(".h5p-element-inner").each((function(){var t,e=Ei(this);this.classList.contains("h5p-table")&&(t=e.find(".h5p-table").outerHeight());var n=e.closest(".h5p-element-outer").innerHeight();void 0!==t&&null!==n&&t>n&&e.attr("tabindex",0)}))},Lo.prototype.setSlideNumberAnnouncer=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="";if(!this.navigationLine)return n;var s=this.slides[t],r=s.keywords&&s.keywords.length>0;r&&!this.navigationLine.isSummarySlide(t)&&(n+=this.l10n.slide+" "+(t+1)+": "),n+=this.navigationLine.createSlideTitle(t),this.$slideAnnouncer.html(n),e&&this.$slideTop.focus()},Lo.prototype.resetTask=function(){this.summarySlideObject.toggleSolutionMode(!1);for(var t=0;t<this.slidesWithSolutions.length;t++)if(void 0!==this.slidesWithSolutions[t])for(var e=0;e<this.slidesWithSolutions[t].length;e++){var n=this.slidesWithSolutions[t][e];n.resetTask&&n.resetTask()}this.navigationLine.updateProgressBar(0),this.jumpToSlide(0,!1),this.$container.find(".h5p-popup-overlay").remove()},Lo.prototype.showSolutions=function(){for(var t=!1,e=[],n=!1,s=0;s<this.slidesWithSolutions.length;s++){if(void 0!==this.slidesWithSolutions[s]){this.elementsAttached[s]||this.attachElements(this.$slidesWrapper.children(":eq("+s+")"),s),t||(this.jumpToSlide(s,!1),t=!0);for(var r=0,i=0,o=[],a=0;a<this.slidesWithSolutions[s].length;a++){var c=this.slidesWithSolutions[s][a];void 0!==c.addSolutionButton&&c.addSolutionButton(),c.showSolutions&&c.showSolutions(),c.showCPComments&&c.showCPComments(),void 0!==c.getMaxScore&&(i+=c.getMaxScore(),r+=c.getScore(),n=!0,o.push(c.coursePresentationIndexOnSlide))}e.push({indexes:o,slide:s+1,score:r,maxScore:i})}if(this.showCommentsAfterSolution[s])for(var l=0;l<this.showCommentsAfterSolution[s].length;l++)"function"==typeof this.showCommentsAfterSolution[s][l].showCPComments&&this.showCommentsAfterSolution[s][l].showCPComments()}if(n)return e},Lo.prototype.getSlideScores=function(t){for(var e=!0===t,n=[],s=!1,r=0;r<this.slidesWithSolutions.length;r++)if(void 0!==this.slidesWithSolutions[r]){this.elementsAttached[r]||this.attachElements(this.$slidesWrapper.children(":eq("+r+")"),r),e||(this.jumpToSlide(r,!1),e=!0);for(var i=0,o=0,a=[],c=0;c<this.slidesWithSolutions[r].length;c++){var l=this.slidesWithSolutions[r][c];void 0!==l.getMaxScore&&(o+=l.getMaxScore(),i+=l.getScore(),s=!0,a.push(l.coursePresentationIndexOnSlide))}n.push({indexes:a,slide:r+1,score:i,maxScore:o})}if(s)return n},Lo.prototype.getCopyrights=function(){var t,e=new H5P.ContentCopyrights;if(this.presentation&&this.presentation.globalBackgroundSelector&&this.presentation.globalBackgroundSelector.imageGlobalBackground){var n=this.presentation.globalBackgroundSelector.imageGlobalBackground,s=new H5P.MediaCopyright(n.copyright);s.setThumbnail(new H5P.Thumbnail(H5P.getPath(n.path,this.contentId),n.width,n.height)),e.addMedia(s)}for(var r=0;r<this.slides.length;r++){var i=new H5P.ContentCopyrights;if(i.setLabel(this.l10n.slide+" "+(r+1)),this.slides[r]&&this.slides[r].slideBackgroundSelector&&this.slides[r].slideBackgroundSelector.imageSlideBackground){var o=this.slides[r].slideBackgroundSelector.imageSlideBackground,a=new H5P.MediaCopyright(o.copyright);a.setThumbnail(new H5P.Thumbnail(H5P.getPath(o.path,this.contentId),o.width,o.height)),i.addMedia(a)}if(void 0!==this.elementInstances[r])for(var c=0;c<this.elementInstances[r].length;c++){var l=this.elementInstances[r][c];if(this.slides[r].elements[c].action){var h=this.slides[r].elements[c].action.params,d=this.slides[r].elements[c].action.metadata;t=void 0,void 0!==l.getCopyrights&&(t=l.getCopyrights()),void 0===t&&(t=new H5P.ContentCopyrights,H5P.findCopyrights(t,h,this.contentId,{metadata:d,machineName:l.libraryInfo.machineName}));var u=c+1;void 0!==h.contentName?u+=": "+h.contentName:void 0!==l.getTitle?u+=": "+l.getTitle():h.l10n&&h.l10n.name&&(u+=": "+h.l10n.name),t.setLabel(u),i.addContent(t)}}e.addContent(i)}return e},Lo.prototype.getXAPIData=function(){var t=this.createXAPIEventTemplate("answered"),e=t.getVerifiedStatementValue(["object","definition"]);H5P.jQuery.extend(e,{interactionType:"compound",type:"http://adlnet.gov/expapi/activities/cmi.interaction"});var n=this.getScore(),s=this.getMaxScore();t.setScoredResult(n,s,this,!0,n===s);var r=Ti(this.slidesWithSolutions).map((function(t){if(t&&t.getXAPIData)return t.getXAPIData()})).filter((function(t){return!!t}));return{statement:t.data.statement,children:r}},Lo.prototype.getContext=function(){return{type:"slide",value:this.currentSlideIndex+1}};const Mo=Lo;H5P=H5P||{},H5P.Tooltip=H5P.Tooltip||function(){},H5P.CoursePresentation=Mo})()})();